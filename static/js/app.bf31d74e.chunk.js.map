{"version":3,"sources":["redux/infoSlice.js","redux/mapSlice.js","store.js","styling/theme.js","components/Header.OnlineStatus.jsx","components/ChatBot.Header.jsx","utils/commonUtil.js","components/ChatBot.ImageMap.jsx","components/ChatBot.InputBox.jsx","components/Message.Normal.jsx","components/Message.InnerBox.jsx","components/Message.Expandable.jsx","components/Message.Options.jsx","components/Message.Start.jsx","components/Message.Main.jsx","components/ChatBot.MessageList.jsx","screens/ChatBotScreen.jsx","screens/MapNavigationScreen.jsx","routes/MyStack.js","index.js","App.js"],"names":["infoSlice","createSlice","name","initialState","instructions","instructionTexts","floor","index","reply","message","dialogMessages","reducers","setInstructions","state","action","payload","setInstructionTexts","setIndex","setReply","setMessage","setFloor","setDialogMessages","actions","selectInstructions","info","selectInstructionTexts","selectIndex","selectDialogMessages","mapSlice","mapFloor","floorArray","floorIndex","setMapFloor","console","log","setFloorArray","length","setFloorIndex","selectMapFloor","map","selectFloorArray","selectFloorIndex","store","configureStore","reducer","infoReducer","mapReducer","theme","primary","white","black","searchIcon","searchText","searchBackground","title","subTitle","storyBorder","description","inputBackground","inputText","messageBackground","danger","success","light","halfOpacitySecondary","halfOpacityPrimary","styles","StyleSheet","create","onlineStatusContainer","flexDirection","paddingHorizontal","onlineStatus","color","fontSize","statusImage","height","width","borderRadius","alignSelf","margin","OnlineStatus","View","style","Text","Image","source","uri","LogBox","ignoreLogs","container","backgroundColor","paddingTop","paddingBottom","backButton","profileOptions","flex","justifyContent","alignItems","profile","borderColor","image","usernameAndOnlineStatus","usernameAndLocationName","username","fontWeight","locationName","options","paddingVertical","mapButton","ChatHeader","botname","sendJsonMessage","navigation","useNavigation","LinearGradient","colors","TouchableOpacity","size","onPress","navigate","getNowTime","today","Date","hour","getHours","min","getMinutes","toString","changePath","tmpInstructions","path","forEach","ins","error","computeVector","p1","p2","x","y","calcAngleDegrees","Math","atan2","PI","rotatePoint","point","angleInDegree","angleInRadian","cos","sin","borderBottomWidth","messageView","maxWidth","Imagemessage","ChatImageMap","useState","imageURL","setImageURL","svgPath","setSvgPath","useSelector","useEffect","slice","ReactNativeZoomableView","maxZoom","minZoom","zoomStep","initialZoom","bindToBorders","ImageBackground","viewBox","id","refX","refY","markerUnits","markerWidth","markerHeight","orient","d","fill","stroke","strokeWidth","cx","cy","r","markerStart","markerMid","markerEnd","position","innerContainer","marginHorizontal","bottom","inputAndMicrophone","marginRight","Platform","OS","input","paddingLeft","rightIconButtonStyle","paddingRight","borderLeftWidth","borderLeftColor","swipeToCancelView","swipeText","emoticonButton","recordingActive","recordingTime","marginLeft","microphoneAndLock","lockView","borderTopLeftRadius","borderTopRightRadius","sendButton","ChatInput","online","dispatch","useDispatch","setInput","microphonecolor","KeyboardAvoidingView","behavior","TextInput","multiline","placeholder","value","onChangeText","text","disabled","inputTextJson","concat","Textmessage","MessageBox","messageContent","isOnLeft","messageType","isComplete","marginVertical","startText","messageContainer","shadowColor","shadowOpacity","shadowOffset","elevation","startmessageContainer","timeView","time","iconContainer","InnerBox","isLeft","completeIndex","floorOrder","indexOf","Number","completeFloorIndex","AIcon","Animated","createAnimatedComponent","Icon","useSharedValue","uas","useAnimatedStyle","transform","translateX","TRANSLATE_X_THRESHOLD","Dimensions","get","InstructionMsgeventHandler","useAnimatedGestureHandler","onActive","event","ctx","translationX","onEnd","runOnJS","Speech","withTiming","rIconStyle","opacity","onGestureEvent","onHandlerStateChange","nativeEvent","left","ExpandableListView","isopen","setIsOpen","innerBox","subCategory","prev","HeadText","categoryName","sub","tinyLogo","overflow","flatli","item","padding","display","alignContent","titleView","Options","optionRefDec","renderItem","prefix","sendOption","undefined","FlatList","extraData","data","keyExtractor","horizontal","Start","instructiontext","Object","keys","Message","setScrollState","largerscale","type","NoralMsgeventHandler","enlarge","ChatMessagessList","user","useRef","scrollView","scrollViewEnable","setScrollViewEnable","newFloorArray","i","len","currentMessage","floorNumber","push","ScrollView","ref","onContentSizeChange","current","scrollToEnd","animated","scrollEnabled","author","ChatBotScreen","ws_scheme","socketUrl","onlinestatus","setOnlineStatus","useWebSocket","onOpen","onError","err","shouldReconnect","closeEvent","reconnectAttempts","reconnectInterval","lastJsonMessage","readyState","connectionStatus","ReadyState","CONNECTING","OPEN","CLOSING","CLOSED","UNINSTANTIATED","newDict","newDict2","JSON","parse","stringify","StatusBar","barStyle","crossPlatformContainer","headerContainer","bodyContainer","flexGrow","bottomContainer","goBackBotton","calibrationButtonViewStyle","calibrationButtonTextStyle","textAlign","stopButtonViewStyle","bgImageStyle","guideContainer","mainTextStyle","multiColumnContaner","subKeywordViewContainer","subKeywordStyle","subTextViewContainer","flexShrink","subTextStyle","paginationButtonContainer","buttonTextStyle","modalViewContainer","modalTextStyle","modalYesButtonStyle","modalNoButtonStyle","MapNavigationScreen","route","params","infoIndex","getNextStepIndices","shift","curFloorIndex","curInfoIndex","flag","result","instructArray","ifGuideStart","getFutureInstructionText","currentFloorIndex","currentInfoIndex","future","notyet_floorIndex","notyet_index","obj","nextInstructionText","setNextInstructionText","goNextStep","res","newFloorIndex","newIndex","setModalContent","setIsModalVisible","zoomableViewRef","zoomVal","imageCenter","initialBasePoint","basePoint","angle","setAngle","scale_to_canvas","vector","targetPoint","previousAutoTotalMove","previousTransformTotalMove","updateBasePoint","rotation_angle","delta_rotation_angle","newPoint","arbitraryPoint","centerPoint","relativeCoordinate","rotatedVector","rotateRelativeToCenter","rotateLineToVertical","point1","point2","needToRotate","basePointGuide_Going","nowPathPoints","updatedAngle","disVector","rotDicVector","disX","disY","moveBy","basePointGuide","calibraOnly","zoomTo","setTimeout","calibraVector","currentPathPoints","all_points","getPathCoordinates","isModalVisible","modalContent","SafeAreaView","Button","goBackView","goBack","MaterialCommunityIcons","onTransform","zoomableViewEventObject","zoomLevel","offsetX","offsetY","img_width","img_height","rotate","borderRightColor","borderRightWidth","isVisible","Stack","createStackNavigator","MyStack","Navigator","initialRouteName","screenOptions","headerShown","gestureEnabled","Screen","component","registerRootComponent","NavigationContainer"],"mappings":"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","file":"static/js/app.bf31d74e.chunk.js","sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\r\n\r\nconst initialState = {\r\n    instructions:{},\r\n    instructionTexts: {}, // Key: floor number; value: instruction text object\r\n    floor:-10,\r\n    index:-1,\r\n    reply:null,\r\n    message:null,\r\n    dialogMessages: [],\r\n}\r\n\r\nexport const infoSlice = createSlice({\r\n    name:'info',\r\n    initialState,\r\n    reducers:{\r\n        setInstructions:(state, action)=>{\r\n            state.instructions = action.payload;\r\n        },\r\n        setInstructionTexts: (state, action) => {\r\n            state.instructionTexts = action.payload;\r\n        },\r\n        setIndex:(state, action)=>{\r\n            state.index = action.payload;\r\n        },\r\n        setReply:(state, action)=>{\r\n            state.reply = action.payload;\r\n        },\r\n        setMessage:(state, action)=>{\r\n            state.message = action.payload;\r\n        },\r\n        setFloor:(state, action)=>{\r\n            state.floor = action.payload;\r\n        },\r\n        setDialogMessages: (state, action) => {\r\n            state.dialogMessages = action.payload;\r\n        }\r\n    },\r\n});\r\n\r\nexport const { setInstructions, setInstructionTexts, setIndex, setReply, setMessage, setFloor, setDialogMessages } = \r\n    infoSlice.actions;\r\n\r\n// Selectors\r\nexport const selectInstructions = (state) => state.info.instructions;\r\nexport const selectInstructionTexts = (state) => state.info.instructionTexts;\r\nexport const selectIndex = (state) => state.info.index;\r\nexport const selectReply = (state) => state.info.reply;\r\nexport const selectMessage = (state) => state.info.message;\r\nexport const selectFloor = (state) => state.info.floor;\r\nexport const selectDialogMessages = (state) => state.info.dialogMessages;\r\n\r\n\r\nexport default infoSlice.reducer; //nav(name) Reducer ==> navReducer","import { createSlice } from \"@reduxjs/toolkit\";\r\n\r\nconst UNKNOWNVALUE = -100;\r\n\r\nexport const mapSlice = createSlice({\r\n    name: 'map',\r\n    initialState: {\r\n        mapFloor: UNKNOWNVALUE,\r\n        floorArray: null,\r\n        floorIndex: -1,\r\n    },\r\n    reducers:{\r\n        setMapFloor: (state, action) => {\r\n            console.log(`地圖的樓層設定為第 ${action.payload} 樓`);\r\n            state.mapFloor = action.payload;\r\n        },\r\n        setFloorArray: (state, action) => {\r\n            state.floorArray = action.payload;\r\n            if (action.payload.length > 0) {\r\n                console.log(`地圖的樓層指引依序為 ${action.payload}`);\r\n            }\r\n        },\r\n        setFloorIndex: (state, action) => {\r\n            state.floorIndex = action.payload;\r\n        }\r\n    },\r\n});\r\n\r\n\r\n// Selectors\r\nexport const selectMapFloor = (state) => state.map.mapFloor;\r\nexport const selectFloorArray = (state) => state.map.floorArray;\r\nexport const selectFloorIndex = (state) => state.map.floorIndex;\r\n\r\nexport const { setMapFloor, setFloorArray, setFloorIndex } = mapSlice.actions;\r\n\r\nexport default mapSlice.reducer; //nav(name) Reducer ==> navReducer","import { configureStore } from '@reduxjs/toolkit'\r\n\r\nimport infoReducer from './redux/infoSlice'\r\nimport mapReducer from './redux/mapSlice'\r\n\r\nexport const store = configureStore({\r\n    reducer: {\r\n        info: infoReducer,\r\n        map: mapReducer,\r\n    },\r\n});","export const theme = {\r\n\tcolors: {\r\n\t\tprimary: '#003153',\r\n\t\twhite: '#fff',\r\n\t\tblack: '#000',\r\n\t\tsearchIcon: '#999',\r\n\t\tsearchText: '#444',\r\n\t\tsearchBackground: '#f0f0f0',\r\n\t\ttitle: \"#000\",\r\n\t\tsubTitle: '#555',\r\n\t\tstoryBorder: '#00f',\r\n\t\tdescription: '#9f9f9f',\r\n\t\tinputBackground: '#f0f0f0',\r\n\t\tinputText: '#000',\r\n\t\tmessageBackground: '#1B5583',\r\n\t\tdanger: '#df4759',\r\n\t\tsuccess: \"#4b0\",\r\n\t\tlight: '#ccc',\r\n\t\thalfOpacitySecondary: 'rgba(240, 149, 17, 0.5)',\r\n\t\thalfOpacityPrimary: 'rgba(0, 132, 255, 0.5)',\r\n\t\tstoryBorder: \"#00f\"\r\n\t},\r\n\tfontSize: {\r\n\t\ttitle: 18,\r\n\t\tsubTitle: 13,\r\n\t\tmessage: 15\r\n\t}\r\n};","import React from 'react';\r\nimport { View, Text, Image, StyleSheet} from 'react-native';\r\nimport { theme } from '../styling/theme';\r\n\r\n\r\nconst OnlineStatus = ({ onlineStatus }) => {\r\n    const onlineText = 'Online';\r\n    const onlineUri = 'https://miro.medium.com/max/512/1*nZ9VwHTLxAfNCuCjYAkajg.png';\r\n    const OfflineText = 'Offline'\r\n    const offlineUri = 'https://pngimage.net/wp-content/uploads/2018/06/rec-icon-png-5.png';\r\n    return onlineStatus ? (\r\n        <View style={styles.onlineStatusContainer}>\r\n            <Text style={styles.onlineStatus}>{onlineText}</Text>\r\n            <Image style={styles.statusImage} source={{uri:onlineUri}} />\r\n        </View>\r\n        )\r\n        :(\r\n        <View style={styles.onlineStatusContainer}>\r\n            <Text style={styles.onlineStatus}>{OfflineText}</Text>\r\n            <Image style={styles.statusImage} source={{uri:offlineUri}} />\r\n        </View>\r\n        )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    onlineStatusContainer:{\r\n\t\tflexDirection:'row',\r\n        paddingHorizontal: 20\r\n\t},\r\n    onlineStatus: {\r\n        color: theme.colors.white,\r\n        fontSize: 16,\r\n    },\r\n    statusImage:{\r\n        height: 5,\r\n        width: 5,\r\n        borderRadius: 32.5,\r\n        alignSelf:'center',\r\n        margin:3,\r\n    }\r\n})\r\nexport default OnlineStatus;","import React from 'react';\r\nimport { View, Text, StyleSheet, TouchableOpacity, LogBox } from 'react-native';\r\nimport Icon from 'react-native-vector-icons/FontAwesome';\r\nimport { theme } from '../styling/theme';\r\nimport { LinearGradient } from 'expo-linear-gradient';\r\nimport OnlineStatus from './Header.OnlineStatus';\r\nimport { useNavigation } from '@react-navigation/native';\r\n\r\n// ignore this warning and pass functions thought route params safely.\r\nLogBox.ignoreLogs([\r\n\t'Non-serializable values were found in the navigation state',\r\n]);\r\n\r\nconst ChatHeader = ({ botname, locationName, onlineStatus, sendJsonMessage}) => {\r\n\t// use the useNavigation to provide the navigation prop automatically\r\n\tconst navigation = useNavigation();\r\n\r\n    return (\r\n\t\t<LinearGradient colors={['#C33764', '#1D2671', '#192f6a']} style={styles.container}>\r\n\t\t\t<TouchableOpacity style={styles.backButton}>\r\n\t\t\t\t<Icon name=\"angle-left\" size={30} color={theme.colors.white} />\r\n\t\t\t</TouchableOpacity>\r\n\t\t\t<View style={styles.profileOptions}>\r\n\t\t\t\t<TouchableOpacity style={styles.profile}>\r\n\t\t\t\t\t<View style={styles.usernameAndLocationName}>\r\n\t\t\t\t\t\t<View style={styles.usernameAndOnlineStatus}>\r\n\t\t\t\t\t\t\t<Text style={styles.username}>{botname}</Text>\r\n\t\t\t\t\t\t\t<OnlineStatus onlineStatus={onlineStatus}/>\r\n\t\t\t\t\t\t</View>\r\n\t\t\t\t\t\t<View>\r\n\t\t\t\t\t\t\t<Text style={styles.locationName}>{locationName}</Text>\r\n\t\t\t\t\t\t</View>\r\n\t\t\t\t\t</View>\r\n\t\t\t\t</TouchableOpacity>\r\n\t\t\t\t<View>\r\n\t\t\t\t\t<TouchableOpacity style={styles.options} onPress={() => navigation.navigate(\"MapNavigation\", {\r\n\t\t\t\t\t\tsendJsonMessage\r\n\t\t\t\t\t})}>\r\n\t\t\t\t\t\t<Text style={styles.mapButton}>地圖模式</Text>\r\n\t\t\t\t\t</TouchableOpacity>\r\n\t\t\t\t</View>\r\n\t\t\t</View>\r\n\t\t</LinearGradient>\r\n    )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n\tcontainer: {\r\n\t\tflexDirection: \"row\",\r\n\t\tbackgroundColor: theme.colors.primary,\r\n\t\tpaddingTop: 25,\r\n\t\tpaddingBottom: 10,\r\n\t},\r\n\tbackButton: {\r\n\t\talignSelf: \"center\",\r\n\t\tpaddingHorizontal: 10,\r\n\t},\r\n\tprofileOptions: {\r\n\t\tflex: 1,\r\n\t\tflexDirection: \"row\",\r\n\t\tjustifyContent: \"space-between\",\r\n\t\talignItems: \"center\",\r\n\t\tpaddingHorizontal: 10,\r\n\t},\r\n\tprofile: {\r\n\t\tflexDirection: \"row\",\r\n\t\talignItems: \"center\",\r\n\t\tborderColor: \"#fff\",\r\n\t\tflex: 4,\r\n\t},\r\n\timage: {\r\n\t\theight: 65,\r\n\t\twidth: 65,\r\n\t\tborderRadius: 32.5,\r\n\t}\r\n\t,\r\n\tusernameAndOnlineStatus: {\r\n\t\tflexDirection: \"row\",\r\n\t\tjustifyContent: \"center\",\r\n\t\tpaddingHorizontal: 10,\r\n\t},\r\n\tusernameAndLocationName: {\r\n\t\tflexDirection: \"column\",\r\n\t\tpaddingHorizontal: 10,\r\n\t},\r\n\tusername: {\r\n\t\tcolor: theme.colors.white,\r\n\t\tfontSize: 18,\r\n\t\tfontWeight: \"bold\",\r\n\t},\r\n\tlocationName: {\r\n\t\tcolor: theme.colors.white,\r\n\t\tfontWeight: \"bold\",\r\n\t\tfontSize: 16,\r\n\t\tpaddingHorizontal: 10,\r\n\t},\r\n\toptions: {\r\n\t\tpaddingHorizontal: 6, \r\n\t\tpaddingVertical: 10, \r\n\t\tborderRadius: 5, \r\n\t\tbackgroundColor: \"#68a0cf\"\r\n\t},\r\n\tmapButton: {\r\n\t\tcolor: \"white\"\r\n\t}\r\n})\r\n\r\nexport default ChatHeader","\r\n/** get current time */\r\nconst getNowTime = () => {\r\n    let today = new Date()\r\n    let hour = today.getHours();\r\n    let min = today.getMinutes();\r\n    if (hour < 10) {\r\n        hour = '0' + hour.toString()\r\n    }\r\n    if (min < 10) {\r\n        min = '0' + min.toString()\r\n    }\r\n    return [hour, min];\r\n};\r\n\r\n/**  Construct svg path expression from instructions */\r\nconst changePath = (tmpInstructions) => {\r\n    \r\n    let path = \"M\"\r\n    try {\r\n        tmpInstructions.forEach((ins, index) => {\r\n\r\n            if (index === 0) {\r\n                path += ins[0] + \",\" + ins[1];\r\n            }\r\n            else {\r\n                path+= \"L\" + ins[0]+ \",\" + ins[1];\r\n            }\r\n        });\r\n    }\r\n    catch(error) {\r\n        throw error;\r\n    }\r\n    // console.log('svg path = ', path);\r\n    return path\r\n};\r\n\r\n/**  Construct svg path's point array from instructions */\r\nconst getPathCoordinates = (tmpInstructions) => {\r\n    let all_points = [];\r\n\r\n    tmpInstructions.forEach((ins) => {\r\n        all_points.push({x: ins[0], y: ins[1]});\r\n    });\r\n\r\n    return all_points;\r\n};\r\n\r\n\r\n// Basic Math\r\nconst radian2Degree = (radianValue) => {\r\n    return radianValue * 180 / Math.PI;\r\n};\r\n\r\nconst degree2Radian = (degreeValue) => {\r\n    return degreeValue * Math.PI / 180;\r\n}\r\n\r\nconst computeVector = (p1, p2) => {\r\n    return {\r\n        x: p2.x - p1.x, \r\n        y: p2.y - p1.y\r\n    };\r\n};\r\n\r\n/** get -180~180 degree number. For canvas, 從x軸起算，順時針為正的角度 */\r\nconst calcAngleDegrees = (x, y) => {\r\n    return radian2Degree(Math.atan2(y, x));\r\n}\r\n\r\n/** angleInDegree: 順時針的角度 */\r\nconst rotatePoint = (point, angleInDegree) => {\r\n    const angleInRadian = degree2Radian(angleInDegree);\r\n\r\n    return {\r\n        x: point.x * Math.cos(angleInRadian) - point.y * Math.sin(angleInRadian), \r\n        y: point.x * Math.sin(angleInRadian) + point.y * Math.cos(angleInRadian)\r\n    };\r\n};\r\n\r\n/** angleInDegree: 順時針的角度 */\r\nconst rotateRelativeToCenter = (arbitraryPoint, centerPoint, angleInDegree) => {\r\n    const relativeCoordinate = {x: arbitraryPoint.x - centerPoint.x, y: arbitraryPoint.y - centerPoint.y};\r\n\r\n    let rotatedVector = rotatePoint(relativeCoordinate, angleInDegree);\r\n    return {\r\n        x: centerPoint.x + rotatedVector.x, \r\n        y: centerPoint.y + rotatedVector.y\r\n    };\r\n};\r\n\r\nexport {\r\n    getNowTime,\r\n    changePath, \r\n    getPathCoordinates, \r\n\r\n    radian2Degree, \r\n    degree2Radian,\r\n    calcAngleDegrees,\r\n    computeVector,\r\n    rotatePoint,\r\n    rotateRelativeToCenter,\r\n};","import React, { useState, useEffect } from \"react\";\r\n\r\nimport { View, StyleSheet, ImageBackground} from 'react-native';\r\nimport ReactNativeZoomableView from '@openspacelabs/react-native-zoomable-view/src/ReactNativeZoomableView';\r\nimport Svg ,{ Defs, Marker, Path, Circle } from 'react-native-svg';\r\n\r\n\r\nimport { useSelector } from 'react-redux';\r\nimport { selectIndex, selectInstructions } from '../redux/infoSlice';\r\nimport { selectMapFloor } from \"../redux/mapSlice\";\r\nimport { changePath } from \"../utils/commonUtil\";\r\n\r\n\r\nconst ChatImageMap = () => {\r\n    // https://reactjs.org/logo-og.png\r\n    // http://61.219.68.130:809/static/image/03.jpeg\r\n    const [imageURL, setImageURL] = useState(\"https://iasl.asia.edu.tw:809/static/image/03.jpeg\")\r\n\r\n    // svg-related settings\r\n    var svg_width = 409.6;\r\n    var svg_height = 222.8;\r\n    var viewBoxProps = \"0 0 1024 557\"; // equal to original image's size\r\n    const [svgPath, setSvgPath] = useState('M 0 0 L 0 0');\r\n    \r\n    // redux\r\n    const instructions = useSelector(selectInstructions);\r\n    const mapFloor = useSelector(selectMapFloor);\r\n    const index = useSelector(selectIndex);\r\n\r\n    useEffect(() => {\r\n        if (mapFloor > -100 && index >= 0) {\r\n            let tmpInstructions = instructions[mapFloor.toString()];\r\n            if (index > 0) {\r\n                tmpInstructions = tmpInstructions.slice(index);\r\n            }\r\n            \r\n            setSvgPath(changePath(tmpInstructions));\r\n            setImageURL(`https://iasl.asia.edu.tw:809/static/image/0${mapFloor}.jpeg`);\r\n        }\r\n        else {\r\n            // default image before indoor guide\r\n            setSvgPath('M 0 0 L 0 0');\r\n            setImageURL(`https://reactjs.org/logo-og.png`);\r\n        }\r\n    }, [mapFloor, index]);\r\n\r\n    \r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <ReactNativeZoomableView\r\n                maxZoom={3}\r\n                minZoom={1}\r\n                zoomStep={0.5}\r\n                initialZoom={1}\r\n                bindToBorders={true}\r\n                style={styles.messageView}\r\n            >\r\n                <ImageBackground source={{ uri: imageURL }} style={[styles.Imagemessage, {width: svg_width, height: svg_height}]}>\r\n                    <Svg width={svg_width} height={svg_height} viewBox={viewBoxProps}>\r\n                        <Defs>\r\n                            <Marker\r\n                                id=\"Triangle\"\r\n                                viewBox=\"0 0 10 10\"\r\n                                refX=\"0\"\r\n                                refY=\"5\"\r\n                                markerUnits=\"strokeWidth\"\r\n                                markerWidth=\"3\"\r\n                                markerHeight=\"3\"\r\n                                orient=\"auto\"\r\n                            >\r\n                                <Path\r\n                                    d=\"M 0 0 L 10 5 L 0 10 z\" \r\n                                    fill=\"black\"\r\n                                    stroke=\"red\"\r\n                                    strokeWidth=\"1\"\r\n                                />\r\n                            </Marker>\r\n                            <Marker\r\n                                id=\"startPoint\"\r\n                                viewBox=\"0 0 10 10\"\r\n                                refX=\"5\"\r\n                                refY=\"5\"\r\n                                markerUnits=\"strokeWidth\"\r\n                                markerWidth=\"3\"\r\n                                markerHeight=\"3\"\r\n                                orient=\"auto\"\r\n                            >\r\n                                    <Circle \r\n                                        cx=\"5\" \r\n                                        cy=\"5\" \r\n                                        r=\"5\" \r\n                                        fill=\"green\"\r\n                                    />\r\n                            </Marker>\r\n                            <Marker\r\n                                id=\"midPoint\"\r\n                                viewBox=\"0 0 10 10\"\r\n                                refX=\"5\"\r\n                                refY=\"5\"\r\n                                markerUnits=\"strokeWidth\"\r\n                                markerWidth=\"2\"\r\n                                markerHeight=\"2\"\r\n                                orient=\"auto\"\r\n                            >\r\n                                <Circle cx=\"5\" cy=\"5\" r=\"5\" fill=\"grey\"/>\r\n                            </Marker>\r\n                        </Defs>\r\n\r\n                        <Path\r\n                            d={svgPath}\r\n                            // d=\"M 0 0 L 10 5 L 0 10 z\"\r\n                            fill=\"none\"\r\n                            stroke=\"black\"\r\n                            strokeWidth=\"10\"\r\n                            markerStart=\"url(#startPoint)\"\r\n                            markerMid=\"url(#midPoint)\"\r\n                            markerEnd=\"url(#Triangle)\"\r\n                        />\r\n                    </Svg>\r\n                </ImageBackground>\r\n            </ReactNativeZoomableView>\r\n        </View>\r\n    );\r\n}\r\n\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        borderColor: \"#9879e0\",\r\n        borderBottomWidth: 1.5,\r\n        flex: 0.6\r\n    },\r\n    messageView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tmaxWidth: \"100%\",\r\n\t},\r\n    Imagemessage: {\r\n\t\talignSelf: \"center\",\r\n\t},\r\n})\r\n\r\nexport default ChatImageMap;","import React, { useState, useEffect } from \"react\";\r\nimport { View,StyleSheet,TextInput, Platform, TouchableOpacity,KeyboardAvoidingView } from \"react-native\";\r\n\r\n// import Voice from \"@react-native-voice/voice\";\r\n\r\nimport Icon from \"react-native-vector-icons/FontAwesome\";\r\nimport { theme } from \"../styling/theme\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { setFloorArray, setMapFloor } from \"../redux/mapSlice\";\r\nimport { selectDialogMessages, setDialogMessages, setInstructionTexts } from \"../redux/infoSlice\";\r\nimport { getNowTime } from \"../utils/commonUtil\"\r\n\r\nconst ChatInput = ({ online, sendJsonMessage}) => {\r\n\tconst dispatch = useDispatch();\r\n\tconst dialogMessages = useSelector(selectDialogMessages);\r\n\r\n\r\n\tconst [input, setInput] = useState(\"\");\r\n\tconst [microphonecolor, setMicrophoneColor] = useState(theme.colors.description)\r\n\t\r\n\r\n\t\r\n\r\n\t// useEffect(() => {\r\n\t// \tVoice.getSpeechRecognitionServices();\r\n\t// \tVoice.onSpeechStart = onSpeechStartHandler;\r\n\t// \tVoice.onSpeechEnd = onSpeechEndHandler;\r\n\t// \tVoice.onSpeechResults = onSpeechResultsHandler;\r\n\t// \tVoice.onSpeechError = onSpeechErrorHandler;\r\n\t\r\n\t// \treturn () => {\r\n\t// \t  Voice.destroy().then(Voice.removeAllListeners);\r\n\t// \t}\r\n\t// }, [])\r\n\r\n\t// const onSpeechErrorHandler = async (e) => {\r\n\t// \tconsole.log(\"error ==>\", e)\r\n\t// \tawait destroyVoiceInstance()\r\n\t// }\r\n\r\n\t// const destroyVoiceInstance = async () => {\r\n\t// \ttry{\r\n\t// \t\tawait Voice.stop();\r\n\t// \t\tawait Voice.destroy().then(Voice.removeAllListeners());\r\n\t// \t}\r\n\t// \tcatch(e){\r\n\t// \t\tconsole.log(e)\r\n\t// \t}\r\n\t\t\r\n\t// }\r\n\t\r\n\t// const onSpeechStartHandler = async (e) => {\r\n\t// \tconsole.log(\"start handler==>>>\", e)\r\n\t// }\r\n\t// const onSpeechEndHandler = async (e) => {\r\n\t// \tconsole.log(\"stop handler\", e)\r\n\t// \ttry {\r\n\t// \t\tawait Voice.stop()\r\n\t// \t\tsetMicrophoneColor(theme.colors.description)\r\n\t// \t} catch (error) {\r\n\t// \t\tconsole.log(\"error raised\", error)\r\n\t// \t}\r\n\t// }\r\n\t\r\n\t// const onSpeechResultsHandler = async (e) => {\r\n\t// \tlet text = e.value[0]\r\n\t// \tlet result = input + text\r\n\t// \tsetInput(result)\r\n\t// \tconsole.log(\"speech result handler\", e)\r\n\t// \ttry {\r\n\t// \t\tawait Voice.stop()\r\n\t// \t\tsetMicrophoneColor(theme.colors.description)\r\n\t// \t} catch (error) {\r\n\t// \t\tconsole.log(\"error raised\", error)\r\n\t// \t}\r\n\t// }\r\n\t\r\n\t// const startRecording = async () => {\r\n\t// \ttry {\r\n\t// \t\tsetMicrophoneColor(theme.colors.danger)\r\n\t// \t\tawait Voice.start('zh-TW', {\r\n\t// \t\t\t\"RECOGNIZER_ENGINE\": \"GOOGLE\",\r\n\t// \t\t\t \"EXTRA_PARTIAL_RESULTS\": true\r\n\t// \t\t  })\r\n\t// \t\tconsole.log('started')\r\n\t// \t} catch (error) {\r\n\t// \t\tconsole.log(\"error raised\", error)\r\n\t// \t}\r\n\t// }\r\n\t// const stopRecording = async () => {\r\n\t// \ttry {\r\n\t// \t\tawait Voice.stop()\r\n\t// \t\tsetMicrophoneColor(theme.colors.description)\r\n\t// \t} catch (error) {\r\n\t// \t\tconsole.log(\"error raised\", error)\r\n\t// \t}\r\n\t// }\r\n\r\n\tconst handleSubmit = () => {\r\n\t\tif (input === '') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet [hour, min] = getNowTime();\r\n\r\n\t\tlet inputTextJson = {\r\n\t\t\t'author': \"user\",\r\n\t\t\t'type':'text',\r\n\t\t\t'message': input,\r\n\t\t\t'time': hour + ':' + min,\r\n\t\t}\r\n\t\tsendJsonMessage(inputTextJson);\r\n\r\n\t\tif (input !== \"/done\") {\r\n\t\t\tdispatch(setDialogMessages(dialogMessages.concat(inputTextJson)));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdispatch(setDialogMessages([]));\r\n\t\t\tdispatch(setMapFloor(-100));\r\n\t\t\tdispatch(setInstructionTexts({}));\r\n\t\t\tdispatch(setFloorArray([]));\r\n\t\t}\r\n\r\n\t\tsetInput('');\r\n\t}\r\n\r\n\r\n\treturn (\r\n\t\t<KeyboardAvoidingView behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"} style={styles.container}>\r\n\r\n\t\t\t<View style={styles.innerContainer}>\r\n\t\t\t\t<View style={styles.inputAndMicrophone}>\r\n\t\t\t\t\t<TextInput\r\n\t\t\t\t\t\tmultiline\r\n\t\t\t\t\t\tplaceholder={\"Type something...\"}\r\n\t\t\t\t\t\tstyle={styles.input}\r\n\t\t\t\t\t\tvalue={input}\r\n\t\t\t\t\t\tonChangeText={(text) => setInput(text)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<TouchableOpacity\r\n\t\t\t\t\t\tstyle={styles.rightIconButtonStyle}\r\n\t\t\t\t\t\t// onPress={startRecording}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t<Icon\r\n\t\t\t\t\t\tname=\"microphone\"\r\n\t\t\t\t\t\tsize={23}\r\n\t\t\t\t\t\tcolor={microphonecolor}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t</TouchableOpacity>\r\n\r\n\t\t\t\t</View>\r\n\t\t\t\t<TouchableOpacity\r\n\t\t\t\t\tstyle={styles.sendButton} \r\n\t\t\t\t\tdisabled={!online} \r\n\t\t\t\t\tonPress={handleSubmit}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon\r\n\t\t\t\t\t\tname=\"send\"\r\n\t\t\t\t\t\tsize={23}\r\n\t\t\t\t\t\tcolor={theme.colors.white}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</TouchableOpacity>\r\n\t\t\t</View>\r\n      \t\t\r\n\t  \t</KeyboardAvoidingView>\r\n\t);\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n\tcontainer: {\r\n\t\tjustifyContent: \"center\",\r\n\t\tbackgroundColor: theme.colors.white,\r\n\t\tposition:\"relative\",\r\n\t},\r\n\tinnerContainer: {\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 13,\r\n\t\tbottom: 2,\r\n\t\tjustifyContent: \"space-between\",\r\n\t\talignItems: \"center\",\r\n\t\tflexDirection: \"row\",\r\n\t\tpaddingVertical: 1,\r\n\t\theight: 70,\r\n\t},\r\n\tinputAndMicrophone: {\r\n\t\tflexDirection: \"row\",\r\n\t\tbackgroundColor: theme.colors.inputBackground,\r\n\t\tflex: 3,\r\n\t\tmarginRight: 10,\r\n\t\tpaddingVertical: Platform.OS === \"ios\" ? 10 : 0,\r\n\t\tborderRadius: 30,\r\n\t\talignItems: \"center\",\r\n\t\tjustifyContent: \"space-between\",\r\n\t},\r\n\tinput: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tpaddingLeft: 20,\r\n\t\tmargin: 3,\r\n\t\tcolor: theme.colors.inputText,\r\n\t\tflex: 2,\r\n\t\tfontSize: 15,\r\n\t\theight: 35,\r\n\t\talignSelf: \"center\",\r\n\t\tjustifyContent:'center',\r\n\t},\r\n\trightIconButtonStyle: {\r\n\t\tjustifyContent: \"center\",\r\n\t\talignItems: \"center\",\r\n\t\tpaddingRight: 20,\r\n\t\tpaddingLeft: 10,\r\n\t\tborderLeftWidth: 1,\r\n\t\tborderLeftColor: \"#fff\",\r\n\t},\r\n\tswipeToCancelView: {\r\n\t\tflexDirection: \"row\",\r\n\t\talignItems: \"center\",\r\n\t\tmarginRight: 30,\r\n\t},\r\n\tswipeText: {\r\n\t\tcolor: theme.colors.description,\r\n\t\tfontSize: 15,\r\n\t},\r\n\temoticonButton: {\r\n\t\tjustifyContent: \"center\",\r\n\t\talignItems: \"center\",\r\n\t\tpaddingLeft: 10,\r\n\t},\r\n\trecordingActive: {\r\n\t\tflexDirection: \"row\",\r\n\t\talignItems: \"center\",\r\n\t\tjustifyContent: \"space-between\",\r\n\t\tpaddingLeft: 10,\r\n\t},\r\n\trecordingTime: {\r\n\t\tcolor: theme.colors.description,\r\n\t\tfontSize: 20,\r\n\t\tmarginLeft: 5,\r\n\t},\r\n\tmicrophoneAndLock: {\r\n\t\talignItems: \"center\",\r\n\t\tjustifyContent: \"flex-end\",\r\n\t},\r\n\tlockView: {\r\n\t\tbackgroundColor: \"#eee\",\r\n\t\twidth: 60,\r\n\t\talignItems: \"center\",\r\n\t\tborderTopLeftRadius: 30,\r\n\t\tborderTopRightRadius: 30,\r\n\t\theight: 130,\r\n\t\tpaddingTop: 20,\r\n\t},\r\n\tsendButton: {\r\n\t\tbackgroundColor: theme.colors.primary,\r\n\t\tborderRadius: 40,\r\n\t\theight: 40,\r\n\t\twidth: 40,\r\n\t\talignItems: \"center\",\r\n\t\tjustifyContent: \"center\",\r\n\t\tpaddingRight: 2,\r\n\t},\r\n});\r\n\r\nexport default ChatInput;","import React from 'react';\r\nimport { View, Text, StyleSheet} from 'react-native';\r\n\r\n\r\nconst MessageBox = ({ messageContent, isOnLeft, messageType, isComplete}) => {\r\n\r\n\tlet finishTextColorStyle = {\r\n\t\tcolor: \"#d1d2de\",\r\n\t};\r\n\r\n\r\n    return (\r\n        <View style={styles.messageView}>\r\n            <Text style={[styles.Textmessage, isOnLeft(messageType), isComplete? finishTextColorStyle: {}]}>\r\n                {messageContent}\r\n            </Text>\r\n        </View>\r\n        \r\n    );\r\n\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n\tmessageView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tmaxWidth: \"80%\",\r\n\t},\r\n\tTextmessage: {\r\n\t\tcolor: \"white\",\r\n\t\talignSelf: \"flex-start\",\r\n\t\tfontSize: 15,\r\n\t},\r\n})\r\n\r\nexport default MessageBox;","import React from \"react\";\r\nimport { View, Text, StyleSheet, Dimensions } from \"react-native\";\r\n\r\nimport MessageBox from \"./Message.Normal\";\r\nimport Animated, {\r\n\tuseAnimatedStyle,\r\n\tuseAnimatedGestureHandler,\r\n\tuseSharedValue,\r\n\twithTiming,\r\n\trunOnJS,\r\n} from \"react-native-reanimated\";\r\nimport {\r\n\tPanGestureHandler,\r\n} from \"react-native-gesture-handler\";\r\nimport Icon from \"react-native-vector-icons/FontAwesome\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { selectIndex } from '../redux/infoSlice';\r\nimport { setFloor, setIndex } from \"../redux/infoSlice\";\r\nimport { theme } from \"../styling/theme\";\r\nimport * as Speech from 'expo-speech';\r\nimport { selectFloorArray, selectFloorIndex, setFloorIndex, setMapFloor } from \"../redux/mapSlice\";\r\n\r\nconst InnerBox = ({ index,message,isOnLeft,floor, messageType,time,isLeft}) => {\r\n\tconst dispatch = useDispatch();\r\n\tconst floorArray = useSelector(selectFloorArray);\r\n\tconst completeIndex = useSelector(selectIndex);\r\n\r\n\tconst floorOrder = floorArray.indexOf(Number(floor));\r\n\tconst completeFloorIndex = useSelector(selectFloorIndex);\r\n\r\n    \r\n\tconst AIcon = Animated.createAnimatedComponent(Icon)\r\n\r\n    const x = useSharedValue(0);\r\n    const uas = useAnimatedStyle(() => {\r\n\t\treturn {\r\n\t\t\ttransform: [{ translateX: x.value }]\r\n\t\t}\r\n\t});\r\n    const SCREEN_WIDTH = Dimensions.get('window').width\r\n\tconst TRANSLATE_X_THRESHOLD = - SCREEN_WIDTH *0.2\r\n\r\n\tconst InstructionMsgeventHandler = useAnimatedGestureHandler({\r\n\t\tonActive: (event, ctx) => {\r\n\t\t\tif (isLeft){\r\n\t\t\t\tx.value = event.translationX;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonEnd: (event, ctx) => {\r\n\t\t\tconst shouldBeDismissed = x.value < TRANSLATE_X_THRESHOLD\r\n\t\t\tif (shouldBeDismissed){\r\n\t\t\t\t// runOnJS(Tts.speak)(message);\r\n\t\t\t\trunOnJS(Speech.speak)(message)\r\n\t\t\t}\r\n\t\t\tx.value = withTiming(0);\r\n\t\t}\r\n\t});\r\n\r\n\tconst rIconStyle = useAnimatedStyle(()=>{\r\n\t\tconst opacity = withTiming(\r\n\t\t\tx.value < TRANSLATE_X_THRESHOLD ? 1 : 1\r\n\t\t);\r\n\t\treturn { opacity }\r\n\t})\r\n\r\n    return (\r\n        <View style={[styles.container]}>\r\n\r\n            <PanGestureHandler\r\n                onGestureEvent={InstructionMsgeventHandler}\r\n                onHandlerStateChange={({ nativeEvent }) => {\r\n                    if(nativeEvent.translationX > 40){\r\n                        dispatch(setIndex(index));\r\n                        dispatch(setFloor(floor));\r\n\t\t\t\t\t\tdispatch(setFloorIndex(floorOrder));\r\n\t\t\t\t\t\tdispatch(setMapFloor(floor));\r\n                        console.log('complete floor index, index and floor : ', floorOrder, index, floor)\r\n                    }\r\n                }}\r\n            >\r\n\t\t\t\t<Animated.View\r\n\t\t\t\t\tstyle={[\r\n\t\t\t\t\t\tstyles.messageContainer,\r\n\t\t\t\t\t\tisOnLeft(\"messageContainer\"),\r\n\t\t\t\t\t\tuas\r\n\t\t\t\t\t]}\r\n\t\t\t\t>\r\n                            <MessageBox \r\n                                \r\n                                messageContent={message}\r\n                                isOnLeft={isOnLeft} \r\n                                messageType={messageType}\r\n\t\t\t\t\t\t\t\tisComplete={floorOrder < completeFloorIndex || (floorOrder == completeFloorIndex && index < completeIndex)}\r\n\t\t\t\t\t\t\t>\r\n\r\n                            </MessageBox>\r\n                            <View style={styles.timeView}>\r\n                                <Text style={[styles.time, isOnLeft(\"time\")]}>\r\n                                    {time}\r\n                                </Text>\r\n                            </View>\r\n\t\t\t\t\t\t\t<Animated.View style={[styles.iconContainer, rIconStyle]}>\r\n\t\t\t\t\t\t\t\t\t<AIcon\r\n\t\t\t\t\t\t\t\t\t\tname=\"volume-up\"\r\n\t\t\t\t\t\t\t\t\t\tcolor={theme.colors.description}\r\n\t\t\t\t\t\t\t\t\t\tstyle={{left:30}}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<AIcon\r\n\t\t\t\t\t\t\t\t\t\tname=\"long-arrow-left\"\r\n\t\t\t\t\t\t\t\t\t\tcolor={theme.colors.description}\r\n\t\t\t\t\t\t\t\t\t\tstyle={{left:30}}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Animated.View>\r\n                        \r\n                    </Animated.View>\r\n            </PanGestureHandler>\r\n         </View>\r\n\r\n    )\r\n\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n\tcontainer: {\r\n\t\tpaddingVertical: 10,\r\n\t\tmarginVertical: 5,\r\n\t},\r\n\tstartText:{\r\n\t\t\r\n\t},\r\n\tmessageContainer: {\r\n\t\tbackgroundColor: '#1D2671',\r\n\t\tmaxWidth:\"90%\",\r\n\t\talignSelf: \"flex-end\",\r\n\t\tflexDirection: \"row\",\r\n\t\tborderRadius: 15,\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 10,\r\n\t\tpaddingTop: 8,\r\n\t\tpaddingBottom: 8,\r\n\t\tshadowColor:'grey',\r\n\t\tshadowOpacity:0.3,\r\n\t\tshadowOffset:{\r\n\t\t\twidth:0,\r\n\t\t\theight:3\r\n\t\t},\r\n\t\televation:5,\r\n\t},\r\n\tstartmessageContainer: {\r\n\t\tmaxWidth:\"90%\",\r\n\t\talignSelf: \"flex-end\",\r\n\t\tflexDirection: \"row\",\r\n\t\tborderRadius: 15,\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 10,\r\n\t\tpaddingTop: 8,\r\n\t\tpaddingBottom: 8,\r\n\t\tshadowColor:'grey',\r\n\t\tshadowOpacity:0.3,\r\n\t\tshadowOffset:{\r\n\t\t\twidth:0,\r\n\t\t\theight:3\r\n\t\t},\r\n\t\televation:5,\r\n\t},\r\n\r\n\ttimeView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tjustifyContent: \"flex-end\",\r\n\t\tpaddingLeft: 10,\r\n\t},\r\n\r\n\ttime: {\r\n\t\tcolor: \"lightgray\",\r\n\t\tfontSize: 10,\r\n\t},\r\n\r\n\ticonContainer:{\r\n\t\t// position:'absolute',\r\n\t\t// right:'40%',\r\n\t\t// height:30,\r\n\t\t// width:30,\r\n\t\t// top:'40%',\r\n\t\tjustifyContent:'center',\r\n\t\talignItems:'center',\r\n\t\tfontSize:30,\r\n\t},\r\n\trightIconButtonStyle: {\r\n\t\tjustifyContent: \"center\",\r\n\t\talignItems: \"center\",\r\n\t\tpaddingRight: 20,\r\n\t\tpaddingLeft: 5,\r\n\t},\r\n    messageView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tmaxWidth: \"80%\",\r\n\t},\r\n\tTextmessage: {\r\n\t\tcolor: \"white\",\r\n\t\talignSelf: \"flex-start\",\r\n\t\tfontSize: 15,\r\n\t},\r\n});\r\n\r\nexport default InnerBox;\r\n","import React, {  useState } from \"react\";\r\nimport { View, Text, StyleSheet, TouchableOpacity,Dimensions } from \"react-native\";\r\n\r\nimport Animated, {\r\n\tuseAnimatedStyle,\r\n\tuseSharedValue,\r\n} from \"react-native-reanimated\";\r\nimport { theme } from \"../styling/theme\";\r\nimport Icon from \"react-native-vector-icons/FontAwesome\";\r\nimport InnerBox from \"./Message.InnerBox\"\r\n\r\nconst ExpandableListView = ({ messageContent, isOnLeft, messageType, time, isLeft, floor}) => {\r\n    const [isopen, setIsOpen] = useState(false)\r\n    const x = useSharedValue(0);\r\n\r\n    var innerBox = messageContent[0].subCategory\r\n    \r\n    const uas = useAnimatedStyle(() => {\r\n\t\treturn {\r\n\t\t\ttransform: [{ translateX: x.value }]\r\n\t\t}\r\n\t});\r\n    const SCREEN_WIDTH = Dimensions.get('window').width;\r\n\tconst TRANSLATE_X_THRESHOLD = - SCREEN_WIDTH *0.2;\r\n\r\n\r\n    return (\r\n        <View>\r\n            <TouchableOpacity onPress={()=> setIsOpen(prev => !prev)}>\r\n                <View style={[styles.container]}>\r\n                    <Animated.View style={uas}>\r\n                        <View\r\n\t\t\t\t\t\t\tstyle={[\r\n\t\t\t\t\t\t\t\tstyles.messageContainer,\r\n\t\t\t\t\t\t\t\tisOnLeft(\"messageContainer\"),\r\n\t\t\t\t\t\t\t]}\r\n                        >\r\n\t\t\t\t\t\t\t<Text style={styles.HeadText}>{messageContent[0].categoryName + \"之指示 \"}    \r\n\t\t\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\t\t\tname= {isopen ?  \"arrow-up\" : \"arrow-down\"}\r\n\t\t\t\t\t\t\t\t\tcolor={theme.colors.description}\r\n\t\t\t\t\t\t\t\t\tstyle={[{left:30}]}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Text>\r\n                        </View>\r\n                    </Animated.View>\r\n                </View>\r\n            </TouchableOpacity>\r\n\r\n\r\n\t\t\t{isopen && innerBox.map((sub,index)=>(\r\n\t\t\t<InnerBox\r\n\t\t\t\tkey={index}\r\n\t\t\t\tindex={sub.index}\r\n\t\t\t\tmessage={sub.name}\r\n\t\t\t\tisOnLeft={isOnLeft} \r\n\t\t\t\tfloor={floor}\r\n\t\t\t\tmessageType={messageType}\r\n\t\t\t\ttime={time}\r\n\t\t\t\tisLeft={isLeft}\r\n\t\t\t/>\r\n\r\n\t\t\t))}\r\n\r\n        </View>\r\n    )\r\n\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n\tcontainer: {\r\n\t\tpaddingVertical: 10,\r\n\t\tmarginVertical: 5,\r\n\t},\r\n\tstartText:{\r\n\t\t\r\n\t},\r\n\tmessageContainer: {\r\n\t\tbackgroundColor: '#1D2671',\r\n\t\tmaxWidth:\"90%\",\r\n\t\talignSelf: \"flex-end\",\r\n\t\tflexDirection: \"row\",\r\n\t\tborderRadius: 15,\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 10,\r\n\t\tpaddingTop: 8,\r\n\t\tpaddingBottom: 8,\r\n\t\tshadowColor:'grey',\r\n\t\tshadowOpacity:0.3,\r\n\t\tshadowOffset:{\r\n\t\t\twidth:0,\r\n\t\t\theight:3\r\n\t\t},\r\n\t\televation:5,\r\n\t},\r\n\tstartmessageContainer: {\r\n\t\tmaxWidth:\"90%\",\r\n\t\talignSelf: \"flex-end\",\r\n\t\tflexDirection: \"row\",\r\n\t\tborderRadius: 15,\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 10,\r\n\t\tpaddingTop: 8,\r\n\t\tpaddingBottom: 8,\r\n\t\tshadowColor:'grey',\r\n\t\tshadowOpacity:0.3,\r\n\t\tshadowOffset:{\r\n\t\t\twidth:0,\r\n\t\t\theight:3\r\n\t\t},\r\n\t\televation:5,\r\n\t},\r\n\r\n\ttimeView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tjustifyContent: \"flex-end\",\r\n\t\tpaddingLeft: 10,\r\n\t},\r\n\r\n\ttime: {\r\n\t\tcolor: \"lightgray\",\r\n\t\tfontSize: 10,\r\n\t},\r\n\r\n\ticonContainer:{\r\n\t\tjustifyContent:'center',\r\n\t\talignItems:'center',\r\n\t\tfontSize:30,\r\n\t},\r\n\trightIconButtonStyle: {\r\n\t\tjustifyContent: \"center\",\r\n\t\talignItems: \"center\",\r\n\t\tpaddingRight: 20,\r\n\t\tpaddingLeft: 5,\r\n\t},\r\n    messageView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tmaxWidth: \"80%\",\r\n\t},\r\n\tTextmessage: {\r\n\t\tcolor: \"white\",\r\n\t\talignSelf: \"flex-start\",\r\n\t\tfontSize: 15,\r\n\t},\r\n});\r\n\r\nexport default ExpandableListView;\r\n","import React from \"react\";\r\nimport { View, Text, StyleSheet, TouchableOpacity, Image, FlatList } from \"react-native\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { selectDialogMessages, setDialogMessages } from \"../redux/infoSlice\";\r\nimport { getNowTime } from \"../utils/commonUtil\";\r\n\r\nconst Options = ({ messageContent,  isOnLeft, messageType, sendJsonMessage, optionRefDec}) => {\r\n    // redux\r\n    const dispatch = useDispatch();\r\n    const dialogMessages = useSelector(selectDialogMessages);\r\n    \r\n\r\n    const sendOption = (item) => {\r\n        const [hour, min] = getNowTime();\r\n\t\tlet prefix = \"\";\r\n\t\tswitch (messageType) {\r\n\t\t\tcase \"option-START\":\r\n\t\t\t\tprefix = \"我在\"\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"option-END\":\r\n\t\t\t\tprefix= \"我要去\"\r\n\t\t\t\tbreak\r\n\t\t\tcase \"option-ask\":\r\n\t\t\t\tprefix=\"我的對面是\"\r\n\t\t\t\tbreak\r\n\t\t}\r\n        let message = item\r\n        let inputTextJson = {\r\n\t\t\t'author':\"user\",\r\n\t\t\t'message':message,\r\n\t\t\t'time':hour + ':' + min,\r\n\t\t\t'type':'text'\r\n\t\t}\r\n        dispatch(setDialogMessages(dialogMessages.concat(inputTextJson)))\r\n\r\n        message = prefix + message\r\n        inputTextJson = {\r\n\t\t\t'author':\"user\",\r\n\t\t\t'message':message,\r\n\t\t\t'time':hour + ':' + min,\r\n\t\t\t'type':'text'\r\n\t\t}\r\n        sendJsonMessage(inputTextJson)\r\n\t}\r\n\r\n    const renderItem = ({item,index}) =>{\r\n        return (\r\n            <TouchableOpacity onPress={()=>sendOption(item)} style={[styles.item]}>\r\n                <View>\r\n                    <View style={[styles.titleView]}>\r\n                        {messageType!=\"option-options\" ? <Image style={styles.tinyLogo} source={{uri:'https://appapi-tc.fg-retail.com.tw//Image/Upload/20210926/eee83edf-904a-471b-a421-4a37aa58cd52.jpg'}}/> : null}\r\n                        <Text style={styles.title} >{item}</Text>\r\n                    </View>\r\n                    {optionRefDec==undefined ? null : <Text style={styles.title}>{optionRefDec[index]}</Text>}\r\n                    \r\n                </View>\r\n            </TouchableOpacity>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <View\r\n            style={[\r\n                styles.container,\r\n                isOnLeft(\"messageContainer\"),\r\n            ]}\r\n        >\r\n            <FlatList\r\n                style={styles.flatli}\r\n                extraData={optionRefDec}\r\n                data={messageContent}\r\n                keyExtractor={item => item}\r\n                renderItem={(item,index)=>renderItem(item,index)}\r\n                horizontal={true}\r\n            />\r\n        </View>\r\n    )\r\n\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        width:\"100%\",\r\n    },\r\n    tinyLogo: {\r\n        width: 20,\r\n        height: 20,\r\n        margin:\"auto\",\r\n        marginVertical: 3,\r\n        marginHorizontal: 3,\r\n        overflow:\"hidden\",\r\n    },\r\n    flatli:{\r\n        backgroundColor:'white',\r\n    },\r\n    item: {\r\n        backgroundColor: '#48b8e8',\r\n        padding: 10,\r\n        borderRadius:15,\r\n        marginVertical: 10,\r\n        marginHorizontal: 6,\r\n        display:\"flex\",\r\n        flexDirection: \"column\",\r\n    },\r\n    title:{\r\n\r\n        alignContent:\"center\",\r\n        alignSelf:\"center\",\r\n        justifyContent:\"center\",\r\n        fontSize:20\r\n    },\r\n    titleView:{\r\n        display:\"flex\",\r\n        flexDirection: \"row\",\r\n    }\r\n});\r\n\r\nexport default Options;\r\n","import { View, Text, StyleSheet, TouchableOpacity } from \"react-native\";\r\nimport Icon from 'react-native-vector-icons/FontAwesome';\r\nimport { useSelector } from 'react-redux';\r\nimport { selectInstructionTexts } from '../redux/infoSlice';\r\n\r\n\r\nconst Start = ({isOnLeft, sendJsonMessage}) => {\r\n\r\n\tconst instructiontext = useSelector(selectInstructionTexts);\r\n\r\n    const sendStart = () => {\r\n\t\tif (Object.keys(instructiontext).length > 0) {\r\n\t\t\t// console.log('已經按過 START 了');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet inputTextJson = {\r\n\t\t\t'author':\"user\",\r\n\t\t\t'message':\"<:START:>\",\r\n\t\t\t'type':'text'\r\n\t\t}\r\n\t\tsendJsonMessage(inputTextJson);\r\n\t}\r\n\r\n    return (\r\n        <View style={[styles.container]}>\r\n            <View\r\n                style={[\r\n                    styles.messageContainer,\r\n                    isOnLeft(\"startmessageContainer\"),\r\n                ]}\r\n            >\r\n                <TouchableOpacity\r\n                    style={styles.rightIconButtonStyle}\r\n                    onPress={sendStart}\r\n                >\r\n                    <Text style={{color:\"white\"}}>\r\n                        START  \r\n                        <Icon name=\"play\" size={15} color=\"white\" />\r\n                    </Text>\r\n                    \r\n                </TouchableOpacity>\r\n            </View>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n\tcontainer: {\r\n\t\tpaddingVertical: 10,\r\n\t\tmarginVertical: 5,\r\n\t},\r\n    messageContainer: {\r\n\t\tbackgroundColor: '#1D2671',\r\n\t\tmaxWidth:\"90%\",\r\n\t\talignSelf: \"flex-end\",\r\n\t\tflexDirection: \"row\",\r\n\t\tborderRadius: 15,\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 10,\r\n\t\tpaddingTop: 8,\r\n\t\tpaddingBottom: 8,\r\n\t\tshadowColor:'grey',\r\n\t\tshadowOpacity:0.3,\r\n\t\tshadowOffset:{\r\n\t\t\twidth:0,\r\n\t\t\theight:3\r\n\t\t},\r\n\t\televation:5,\r\n\t},\r\n    rightIconButtonStyle: {\r\n\t\tjustifyContent: \"center\",\r\n\t\talignItems: \"center\",\r\n\t\tpaddingRight: 20,\r\n\t\tpaddingLeft: 5,\r\n\t},\r\n});\r\n \r\nexport default Start;","import React from \"react\";\r\nimport { View, Text, StyleSheet, Dimensions, TouchableOpacity } from \"react-native\";\r\nimport {\r\n\tPanGestureHandler,\r\n} from \"react-native-gesture-handler\";\r\nimport Animated, {\r\n\tuseAnimatedStyle,\r\n\tuseAnimatedGestureHandler,\r\n\tuseSharedValue,\r\n\twithTiming,\r\n\trunOnJS,\r\n} from \"react-native-reanimated\";\r\nimport { theme } from \"../styling/theme\";\r\n\r\nimport MessageBox from \"./Message.Normal\";\r\nimport Icon from 'react-native-vector-icons/FontAwesome';\r\nimport ExpandableListV from \"./Message.Expandable\";\r\nimport Options from \"./Message.Options\"\r\nimport * as Speech from 'expo-speech';\r\nimport Start from \"./Message.Start\";\r\n\r\n\r\nconst Message = ({ time, isLeft, message, messageType, floor, index,optionRefDec, setScrollState, sendJsonMessage}) => {\r\n\tconst x = useSharedValue(0);\r\n\tconst largerscale = useSharedValue(12);\r\n\r\n\r\n\tconst AIcon = Animated.createAnimatedComponent(Icon)\r\n\r\n\tconst SCREEN_WIDTH = Dimensions.get('window').width;\r\n\tconst TRANSLATE_X_THRESHOLD = - SCREEN_WIDTH *0.2;\r\n\r\n\tconst isOnLeft = (type) => {\r\n\t\tif (isLeft && type === \"messageContainer\") {\r\n\t\t\treturn {\r\n\t\t\t\talignSelf: \"flex-start\",\r\n\t\t\t\tbackgroundColor: \"#f0f0f0\",\r\n\t\t\t\tborderTopLeftRadius: 0,\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (isLeft && type === \"startmessageContainer\"){\r\n\t\t\treturn {\r\n\t\t\t\talignSelf: \"flex-start\",\r\n\t\t\t\tbackgroundColor: \"#1B17E6\",\r\n\t\t\t\tborderTopLeftRadius: 0,\r\n\t\t\t};\r\n\t\t\r\n\t\t}\r\n\t\telse if ((isLeft && type === \"text\") || (isLeft && type ===\"instructiontext\")) {\r\n\t\t\treturn {\r\n\t\t\t\tcolor: \"#000\",\r\n\t\t\t};\r\n\t\t}\r\n\t\telse if (isLeft && type === \"time\") {\r\n\t\t\treturn {\r\n\t\t\t\tcolor: \"darkgray\",\r\n\t\t\t};\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn {\r\n\t\t\t\tborderTopRightRadius: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\t\r\n\r\n\tconst NoralMsgeventHandler = useAnimatedGestureHandler({\r\n\t\tonActive: (event, ctx) => {\r\n\t\t\tif (isLeft && event.translationX<0){\r\n\t\t\t\tx.value = event.translationX;\r\n\t\t\t\tlargerscale.value =  event.translationX\r\n\t\t\t}\r\n\t\t},\r\n\t\tonEnd: (event, ctx) => {\r\n\t\t\tconst shouldBeDismissed = x.value < TRANSLATE_X_THRESHOLD\r\n\t\t\tif (shouldBeDismissed){\r\n\t\t\t\t// runOnJS(Tts.speak)(message);\r\n\t\t\t\trunOnJS(Speech.speak)(message)\r\n\t\t\t}\r\n\t\t\tx.value = withTiming(0);\r\n\t\t\tlargerscale.value = withTiming(0)\r\n\t\t}\r\n\t});\r\n\r\n\r\n\r\n\tconst rIconStyle = useAnimatedStyle(()=>{\r\n\t\tconst opacity = withTiming(\r\n\t\t\tx.value < TRANSLATE_X_THRESHOLD ? 1 : 1\r\n\t\t);\r\n\t\treturn { opacity }\r\n\t})\r\n\r\n\r\n\r\n\tconst uas = useAnimatedStyle(() => {\r\n\t\treturn {\r\n\t\t\ttransform: [{ translateX: x.value }]\r\n\t\t}\r\n\t});\r\n\r\n\tconst enlarge = useAnimatedStyle(() => {\r\n\t\tconst fontSize = withTiming(\r\n\t\t\tlargerscale.value < TRANSLATE_X_THRESHOLD ? 20 : 12\r\n\t\t);\r\n\t\treturn { fontSize:fontSize }\r\n\t});\r\n\r\n\tswitch(messageType){\r\n\t\tcase 'state':\r\n\t\t\treturn (\r\n\t\t\t\t<Start \r\n\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\tsendJsonMessage={sendJsonMessage}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\r\n\t\tcase 'option-START':\r\n\t\t\treturn (\r\n\t\t\t\t<Options\r\n\t\t\t\t\tmessageContent={message}\r\n\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\tmessageType={messageType}\r\n\t\t\t\t\tsendJsonMessage={sendJsonMessage}\r\n\t\t\t\t\toptionRefDec={optionRefDec}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\t\tcase 'option-END':\r\n\t\t\treturn (\r\n\t\t\t\t<Options\r\n\t\t\t\t\tmessageContent={message}\r\n\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\tmessageType={messageType}\r\n\t\t\t\t\tsendJsonMessage={sendJsonMessage}\r\n\t\t\t\t\toptionRefDec={optionRefDec}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\t\tcase 'option-ASK':\r\n\t\t\treturn (\r\n\t\t\t\t<Options\r\n\t\t\t\t\tmessageContent={message}\r\n\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\tmessageType={messageType}\r\n\t\t\t\t\tsendJsonMessage={sendJsonMessage}\r\n\t\t\t\t\toptionRefDec={optionRefDec}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\t\t\r\n\t\tcase 'option-options':\r\n\t\t\treturn (\r\n\t\t\t\t<Options\r\n\t\t\t\t\tmessageContent={message}\r\n\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\tmessageType={messageType}\r\n\t\t\t\t\tsendJsonMessage={sendJsonMessage}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\t\tcase 'instructiontext':\r\n\t\t\treturn (\r\n\t\t\t\t<ExpandableListV\r\n\t\t\t\t\tmessageContent={message}\r\n\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\tmessageType={messageType}\r\n\t\t\t\t\ttime={time}\r\n\t\t\t\t\tisLeft={isLeft}\r\n\t\t\t\t\tfloor={floor}\r\n\t\t\t\t\t// Tts={Tts}\r\n\t\t\t\t/>\r\n\t\t\t)\r\n\t\tcase 'text':\r\n\t\t\treturn (\r\n\t\t\t\t\t<View style={[styles.container]}>\r\n\r\n\t\t\t\t\t\t<PanGestureHandler\r\n\t\t\t\t\t\t\tonGestureEvent={NoralMsgeventHandler}\r\n\t\t\t\t\t\t>\r\n\t\t\r\n\t\t\t\t\t\t\t<Animated.View style={uas}>\r\n\t\t\t\t\t\t\t\t<View\r\n\t\t\t\t\t\t\t\t\tstyle={[\r\n\t\t\t\t\t\t\t\t\t\tstyles.messageContainer,\r\n\t\t\t\t\t\t\t\t\t\tisOnLeft(\"messageContainer\"),\r\n\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\r\n\t\t\t\t\t\t\t\t\t<MessageBox\r\n\t\t\t\t\t\t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t\t\t\t\t\t\t\t\tmessageType={messageType}\r\n\t\t\t\t\t\t\t\t\t\tmessageContent={message}\r\n\t\t\t\t\t\t\t\t\t\tisComplete={false}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<View style={styles.timeView}>\r\n\t\t\t\t\t\t\t\t\t\t<Text style={[styles.time, isOnLeft(\"time\")]}>\r\n\t\t\t\t\t\t\t\t\t\t\t{time}\r\n\t\t\t\t\t\t\t\t\t\t</Text>\r\n\t\t\t\t\t\t\t\t\t</View>\r\n\t\t\t\t\t\t\t\t\t<Animated.View style={[styles.iconContainer, rIconStyle]}>\r\n\t\t\t\t\t\t\t\t\t\t<AIcon\r\n\t\t\t\t\t\t\t\t\t\t\tname=\"volume-up\"\r\n\t\t\t\t\t\t\t\t\t\t\tcolor={theme.colors.description}\r\n\t\t\t\t\t\t\t\t\t\t\tstyle={[{left:30},enlarge]}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<AIcon\r\n\t\t\t\t\t\t\t\t\t\t\tname=\"long-arrow-left\"\r\n\t\t\t\t\t\t\t\t\t\t\tcolor={theme.colors.description}\r\n\t\t\t\t\t\t\t\t\t\t\tstyle={[{left:30},enlarge]}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</Animated.View>\r\n\t\t\r\n\t\t\t\t\t\t\t\t</View>\r\n\t\t\t\t\t\t\t</Animated.View>\r\n\t\t\t\t\t\t</PanGestureHandler>\r\n\r\n\t\t\t\t\t</View>\r\n\t\t\t)\r\n\t\tcase 'image':\r\n\t\t\treturn (\r\n\t\t\t\t// empty view, this has been moved to ChatBot.ImageMap.jsx\r\n\t\t\t\t<View></View>\r\n\t\t\t);\r\n\r\n\t\t\t\r\n\r\n\t\t// \treturn (\r\n\t\t// \t\t<Animated.View style={[styles.container]}>\r\n\t\t// \t\t\t<View\r\n\t\t// \t\t\t\tstyle={[\r\n\t\t// \t\t\t\t\tstyles.messageContainer,\r\n\t\t// \t\t\t\t\tisOnLeft(\"messageContainer\"),\r\n\t\t// \t\t\t\t]}\r\n\t\t// \t\t\t>\r\n\t\t// \t\t\t\t<ImageBox\r\n\t\t// \t\t\t\t\tisOnLeft={isOnLeft}\r\n\t\t// \t\t\t\t\tmessageContent={message}\r\n\t\t// \t\t\t\t\tmessageType={messageType}\r\n\t\t// \t\t\t\t\tfloor={floor}\r\n\t\t// \t\t\t\t\tsetScrollState={setScrollState}\r\n\t\t// \t\t\t\t/>\r\n\t\t// \t\t\t\t<View style={styles.timeView}>\r\n\t\t// \t\t\t\t\t<Text style={[styles.time, isOnLeft(\"time\")]}>\r\n\t\t// \t\t\t\t\t\t{time}\r\n\t\t// \t\t\t\t\t</Text>\r\n\t\t// \t\t\t\t</View>\r\n\t\t// \t\t\t</View>\r\n\t\t// \t\t</Animated.View>\r\n\t\t// \t)\r\n\t}\r\n\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n\tcontainer: {\r\n\t\tpaddingVertical: 10,\r\n\t\tmarginVertical: 5,\r\n\t},\r\n\tmessageContainer: {\r\n\t\tbackgroundColor: '#1D2671',\r\n\t\tmaxWidth:\"90%\",\r\n\t\talignSelf: \"flex-end\",\r\n\t\tflexDirection: \"row\",\r\n\t\tborderRadius: 15,\r\n\t\tpaddingHorizontal: 10,\r\n\t\tmarginHorizontal: 10,\r\n\t\tpaddingTop: 8,\r\n\t\tpaddingBottom: 8,\r\n\t\tshadowColor:'grey',\r\n\t\tshadowOpacity:0.3,\r\n\t\tshadowOffset:{\r\n\t\t\twidth:0,\r\n\t\t\theight:3\r\n\t\t},\r\n\t\televation:5,\r\n\t},\r\n\ttimeView: {\r\n\t\tbackgroundColor: \"transparent\",\r\n\t\tjustifyContent: \"flex-end\",\r\n\t\tpaddingLeft: 10,\r\n\t},\r\n\ttime: {\r\n\t\tcolor: \"lightgray\",\r\n\t\tfontSize: 10,\r\n\t},\r\n\ticonContainer:{\r\n\t\tjustifyContent:'center',\r\n\t\talignItems:'center',\r\n\t\tfontSize:30,\r\n\t},\r\n});\r\n\r\nexport default Message;\r\n","import React, { useState, useRef, useEffect } from \"react\";\r\nimport { Platform, ScrollView, KeyboardAvoidingView } from \"react-native\";\r\n// import Tts from 'react-native-tts';\r\nimport { theme } from \"../styling/theme\";\r\nimport Message from \"./Message.Main\";\r\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { selectDialogMessages, selectInstructions, setIndex } from \"../redux/infoSlice\";\r\nimport { selectFloorIndex, selectMapFloor, setFloorArray, setFloorIndex, setMapFloor } from \"../redux/mapSlice\";\r\n\r\n\r\n\r\nconst ChatMessagessList = ({ sendJsonMessage }) => {\r\n\tconst user = useRef(\"user\");\r\n\tconst scrollView = useRef();\r\n\tconst [scrollViewEnable, setScrollViewEnable] = useState(true);\r\n\r\n\tconst dispatch = useDispatch();\r\n\tconst dialogMessages = useSelector(selectDialogMessages);\r\n\tconst instructions = useSelector(selectInstructions);\r\n\tconst mapFloor = useSelector(selectMapFloor);\r\n\tconst floorIndex = useSelector(selectFloorIndex);\r\n\tuseEffect(() => {\r\n\t\tlet newFloorArray = [];\r\n\t\tfor (var i=0, len=dialogMessages.length; i<len; ++i) {\r\n\t\t\tlet currentMessage = dialogMessages[i];\r\n\t\t\tif (currentMessage['type'] === 'image') {\r\n\t\t\t\tlet floorNumber = Number(currentMessage['floor']);\r\n\t\t\t\tnewFloorArray.push(floorNumber);\r\n\t\t\t\tif (mapFloor == -100) {\r\n\t\t\t\t\tdispatch(setMapFloor(floorNumber));\r\n\t\t\t\t\tdispatch(setIndex(0));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (newFloorArray.length > 0 && floorIndex == -1) {\r\n\t\t\t// 如果 FloorArray 開始有值，floorIndex 還在未定義的狀態: 表示剛開始要導航，這時強制設定floor index = 0\r\n\t\t\tdispatch(setFloorIndex(0));\r\n\t\t}\r\n\t\tdispatch(setFloorArray(newFloorArray)); \r\n    }, [instructions])\r\n\r\n\r\n\treturn (\r\n\t\t<ScrollView style={{ backgroundColor: theme.colors.white, flex: 1 }}\r\n\t\t\tref={scrollView}\r\n\t\t\tonContentSizeChange={() => {\r\n\t\t\t\tscrollView.current.scrollToEnd({ animated: true })\r\n\t\t\t}}\r\n\t\t\tscrollEnabled={scrollViewEnable}\r\n\t\t\t// onTouchEnd={() => { setScrollViewEnable(true) }}\r\n\t\t\t// onTouchStart={(event) => {\r\n\t\t\t// \tif (event.nativeEvent.locationY < 600) setScrollViewEnable(false);\r\n\r\n\t\t\t// }}\r\n\t\t>\r\n\t\t\t<KeyboardAvoidingView\r\n                behavior={Platform && Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                style={{flex:1}}\r\n              >\r\n\t\t\t\t<GestureHandlerRootView>\r\n\t\t\t\t{dialogMessages.map((message, index) => \r\n\t\t\t\t\t(message.author != undefined) ?\r\n\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\ttime={message.time}\r\n\t\t\t\t\t\t\tisLeft={message.author !== user.current}\r\n\t\t\t\t\t\t\tmessage={message.message}\r\n\t\t\t\t\t\t\tmessageType={message.type}\r\n\t\t\t\t\t\t\tfloor={message.floor}\r\n\t\t\t\t\t\t\tindex = {message.index}\r\n\t\t\t\t\t\t\toptionRefDec = {message.optionRefDec}\r\n\t\t\t\t\t\t\tsetScrollState = {setScrollViewEnable}\r\n\t\t\t\t\t\t\tsendJsonMessage={sendJsonMessage}\r\n\t\t\t\t\t\t/> : null\r\n\t\t\t\t)}\r\n\t\t\t\t</GestureHandlerRootView>\r\n\t\t\t</KeyboardAvoidingView>\r\n\r\n\t\t</ScrollView>\r\n\t);\r\n};\r\n\r\nexport default ChatMessagessList;","import { useState, useEffect } from 'react';\r\nimport { StyleSheet, View, StatusBar, Platform  } from 'react-native';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { selectDialogMessages, selectInstructions, selectInstructionTexts, setDialogMessages, setInstructions, setInstructionTexts } from '../redux/infoSlice';\r\nimport useWebSocket, { ReadyState } from 'react-native-use-websocket';\r\nimport ChatHeader from '../components/ChatBot.Header';\r\nimport ChatImageMap from '../components/ChatBot.ImageMap';\r\nimport ChatInput from '../components/ChatBot.InputBox';\r\nimport ChatMessagessList from '../components/ChatBot.MessageList';\r\n\r\n// websocket url: (local)  ws://10.0.2.2:8000/ws/bots/       ws://127.0.0.1:8000/ws/bots/\r\n// websocket url: (remote) ws://61.219.68.130:808/websocket\r\n\r\n\r\nconst ChatBotScreen = ({navigation}) => {\r\n    const [botname, setBotName] = useState(\"Indoor Navigation\");\r\n\r\n    // use ws: if you test on android Emulator\r\n    let ws_scheme = 'wss:';\r\n    const [socketUrl, setSocketUrl] = useState(`${ws_scheme}//iasl.asia.edu.tw:808/websocket`);\r\n    const [onlinestatus, setOnlineStatus] = useState(false);\r\n\r\n    // redux\r\n    const dispatch =  useDispatch();\r\n    const instructions = useSelector(selectInstructions);\r\n    const instructiontext = useSelector(selectInstructionTexts);\r\n    const dialogMessages = useSelector(selectDialogMessages);\r\n\r\n    // websocket\r\n    const { sendJsonMessage, lastJsonMessage, readyState } = useWebSocket(socketUrl, {\r\n        onOpen: () => {\r\n            console.log('connected');\r\n            setOnlineStatus(true);\r\n        },\r\n        onError: (err) => {\r\n            console.log(\"[CHATBOTIASL][ERROR][WEBSOCKET]:\", err);\r\n        },\r\n        shouldReconnect: (closeEvent) => true,\r\n        reconnectAttempts: 30,\r\n        reconnectInterval: 3000,\r\n    });\r\n      \r\n    const connectionStatus = {\r\n        [ReadyState.CONNECTING]: \"Connecting\",\r\n        [ReadyState.OPEN]: \"Open\",\r\n        [ReadyState.CLOSING]: \"Closing\",\r\n        [ReadyState.CLOSED]: \"Closed\",\r\n        [ReadyState.UNINSTANTIATED]: \"Uninstantiated\",\r\n    }[readyState];\r\n\r\n    //connectionStatus change UI\r\n    useEffect(()=> {\r\n        setOnlineStatus(connectionStatus === 'Open');\r\n    }, [connectionStatus]);\r\n    \r\n    //onmessage\r\n    useEffect(() => {\r\n        console.log('message : ',lastJsonMessage);\r\n\r\n        if (lastJsonMessage !== null && lastJsonMessage !== {}) {\r\n            if (lastJsonMessage.instructions !== undefined) {\r\n                try {\r\n                    let newDict = {...instructions, ...lastJsonMessage.instructions};\r\n                    dispatch(setInstructions(newDict));\r\n                }\r\n                catch{}\r\n\r\n                if (lastJsonMessage.type === 'instructiontext') {\r\n                    let newDict2 = JSON.parse(JSON.stringify(instructiontext));\r\n                    newDict2[lastJsonMessage.floor] = lastJsonMessage.message[0];\r\n                    dispatch(setInstructionTexts(newDict2));\r\n                }\r\n            }\r\n\r\n            dispatch(setDialogMessages(dialogMessages.concat(lastJsonMessage)));\r\n        }\r\n    }, [lastJsonMessage]);\r\n\r\n    useEffect(() => {\r\n        console.log('Your platform :', Platform.OS);\r\n    }, []);\r\n\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <StatusBar backgroundColor=\"#b3e6ff\" barStyle=\"dark-content\" />\r\n            <ChatHeader\r\n                botname={botname}\r\n                locationName={\"遠雄廣場\"}\r\n                onlineStatus={onlinestatus} \r\n                sendJsonMessage={sendJsonMessage}\r\n            />\r\n            <ChatImageMap />\r\n            <ChatMessagessList\r\n                sendJsonMessage={sendJsonMessage}\r\n            />\r\n            <ChatInput\r\n                online={onlinestatus}\r\n                sendJsonMessage={sendJsonMessage}\r\n            />\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1\r\n    },\r\n});\r\n \r\nexport default ChatBotScreen;\r\n","import { useState, useEffect, useRef } from 'react';\r\nimport { StyleSheet, View, Button, ImageBackground, Text, TouchableOpacity, Platform, SafeAreaView } from 'react-native';\r\nimport MaterialCommunityIcons from 'react-native-vector-icons/MaterialCommunityIcons';\r\nimport ReactNativeZoomableView from '@openspacelabs/react-native-zoomable-view/src/ReactNativeZoomableView';\r\nimport Svg ,{ Defs, Marker, Path, Circle } from 'react-native-svg';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Modal from \"react-native-modal\";\r\nimport { selectInstructions, selectInstructionTexts, selectIndex, setIndex, setDialogMessages, setInstructionTexts } from '../redux/infoSlice';\r\nimport { selectMapFloor, selectFloorArray, selectFloorIndex, setFloorIndex, setMapFloor, setFloorArray } from '../redux/mapSlice';\r\nimport { calcAngleDegrees, changePath, computeVector, getNowTime, getPathCoordinates, rotatePoint, rotateRelativeToCenter } from '../utils/commonUtil';\r\n\r\n\r\nconst MapNavigationScreen = ({route, navigation}) => {\r\n\r\n    const { sendJsonMessage } = route.params;\r\n\r\n    // redux\r\n    const dispatch = useDispatch();\r\n    const instructions = useSelector(selectInstructions);\r\n    const mapFloor = useSelector(selectMapFloor);\r\n\r\n    const instructiontext = useSelector(selectInstructionTexts);\r\n    const infoIndex = useSelector(selectIndex);\r\n    const floorArray = useSelector(selectFloorArray);\r\n    const floorIndex = useSelector(selectFloorIndex);\r\n\r\n    const getNextStepIndices = (shift, curFloorIndex, curInfoIndex) => {\r\n        if (shift < 0) {\r\n            if (curInfoIndex == 0 && curFloorIndex == 0) {\r\n                return {\r\n                    flag: false,\r\n                    result: []\r\n                };\r\n            }\r\n\r\n            if (curInfoIndex != 0) {\r\n                return {\r\n                    flag: true,\r\n                    result: [\r\n                        {index: curInfoIndex - 1}\r\n                    ]\r\n                }\r\n            }\r\n            else {\r\n                let instructArray = instructiontext[floorArray[curFloorIndex-1]][\"subCategory\"];\r\n                return {\r\n                    flag: true,\r\n                    result: [\r\n                        {floor: curFloorIndex - 1},\r\n                        {index: instructArray.length - 1}\r\n                    ]\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            let instructArray = instructiontext[floorArray[curFloorIndex]][\"subCategory\"];\r\n            if (curFloorIndex == floorArray.length - 1 && curInfoIndex == instructArray.length - 1) {\r\n                return {\r\n                    flag: false,\r\n                    result: []\r\n                };\r\n            }\r\n\r\n            if (curInfoIndex < instructArray.length - 1) {\r\n                return {\r\n                    flag: true,\r\n                    result:[\r\n                        {index: curInfoIndex + 1}\r\n                    ]\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    flag: true,\r\n                    result: [\r\n                        {index: 0},\r\n                        {floor: curFloorIndex + 1}\r\n                    ]\r\n                };\r\n            }\r\n        }\r\n    };\r\n\r\n    const ifGuideStart = () => {\r\n        // console.log('instructiontext !== {}: ,', instructiontext !== {});\r\n        // console.log('floorArray != []: ,', floorArray != []);\r\n\r\n        return floorArray.length > 0 && infoIndex !== -1;\r\n    };\r\n\r\n    const getFutureInstructionText = (currentFloorIndex, currentInfoIndex) => {\r\n        if (!ifGuideStart()) {\r\n            return \"\";\r\n        }\r\n\r\n        const future = getNextStepIndices(1, currentFloorIndex, currentInfoIndex);\r\n        if (!future.flag) {\r\n            return \"(已完成)\";\r\n        }\r\n        else {\r\n            let notyet_floorIndex = currentFloorIndex;\r\n            let notyet_index = currentInfoIndex;\r\n            future.result.forEach((obj) => {\r\n                if (obj.index !== undefined) {\r\n                    notyet_index = obj.index;\r\n                }\r\n                else {\r\n                    notyet_floorIndex = obj.floor;\r\n                }\r\n            });\r\n            return instructiontext[floorArray[notyet_floorIndex]][\"subCategory\"][notyet_index][\"name\"];\r\n        }\r\n    };\r\n\r\n    const [nextInstructionText, setNextInstructionText] = useState(getFutureInstructionText(floorIndex, infoIndex));\r\n\r\n    const goNextStep = (shift) => {\r\n\r\n        const res = getNextStepIndices(shift, floorIndex, infoIndex);\r\n        if (!res.flag) {\r\n            if (shift > 0) {\r\n                // 詢問是否結束導航\r\n                setModalContent(\"你已完成導航路徑，確定要結束嗎?\");\r\n                setIsModalVisible(true);\r\n\r\n            }\r\n            return;\r\n        }\r\n        else {\r\n            let newFloorIndex = floorIndex;\r\n            let newIndex = infoIndex;\r\n\r\n            res.result.forEach((obj) => {\r\n                if (obj.index !== undefined) {\r\n                    newIndex = obj.index;\r\n                    dispatch(setIndex(obj.index));\r\n                }\r\n                else {\r\n                    newFloorIndex = obj.floor;\r\n                    dispatch(setFloorIndex(obj.floor));\r\n                    dispatch(setMapFloor(floorArray[obj.floor]));\r\n                }\r\n            });\r\n\r\n            setNextInstructionText(getFutureInstructionText(newFloorIndex, newIndex));\r\n        }\r\n    };\r\n\r\n    // svg\r\n    const [imageURL, setImageURL] = useState(\"https://iasl.asia.edu.tw:809/static/image/03.jpeg\")\r\n\r\n    const img_width = 1024;\r\n    const img_height = 557;\r\n\r\n    const ratio_img_to_svg = 2.5;\r\n    var svg_width = img_width / ratio_img_to_svg;   // 409.6\r\n    var svg_height = img_height / ratio_img_to_svg; // 222.8\r\n    var viewBoxProps = \"0 0 1024 557\"; // equal to original image's size\r\n\r\n    const [svgPath, setSvgPath] = useState('M 0 0 L 0 0');\r\n\r\n    // ZoomableView centering\r\n    const zoomableViewRef = useRef();\r\n    const initialZoomValue = 4;\r\n    let zoomVal = useRef(initialZoomValue);\r\n    // coordinate of imageCenter, when image center coincides with 畫面 center\r\n    const imageCenter = { x: 0.5*img_width, y: 0.5*img_height };\r\n    const initialBasePoint = {x: 0.5*img_width, y: 0.5*img_height + 160*ratio_img_to_svg/initialZoomValue};\r\n    let basePoint = useRef(initialBasePoint);\r\n    const [angle, setAngle] = useState(0);\r\n\r\n    const scale_to_canvas = (vector) => {\r\n        return [initialZoomValue*(vector.x/ratio_img_to_svg), initialZoomValue*(vector.y/ratio_img_to_svg)];\r\n    };\r\n\r\n    const distance_center_target = (goal) => {\r\n\r\n        const deltaVector = computeVector(imageCenter, goal);\r\n        return scale_to_canvas(deltaVector);\r\n    };\r\n\r\n    let targetPoint = {x: 0, y: 0};\r\n    let [previousMove, setPreviousMove] = useState({x:0, y:0});\r\n    // for base point guide\r\n    let previousAutoTotalMove = useRef({x: 0, y: 0});\r\n    let previousTransformTotalMove = useRef({x: 0, y: 0});\r\n\r\n    const updateBasePoint = (rotation_angle) => {\r\n        const delta_rotation_angle = rotation_angle - angle;\r\n        //console.log(`basePoint 原先為 (${basePoint.current.x}, ${basePoint.current.y})`);\r\n\r\n        let newPoint = rotateRelativeToCenter(basePoint.current, imageCenter, -delta_rotation_angle);\r\n        basePoint.current = {x: newPoint.x, y: newPoint.y};\r\n\r\n        //console.log(`basePoint 更新為 (${basePoint.current.x}, ${basePoint.current.y})`);\r\n    };\r\n\r\n    /** (依圖片中心)順時針轉 ? 度 */ \r\n    const doRotation = (rotation_angle) => {\r\n        // 原本轉角 = angle，現在要更新為 rotation_angle\r\n        setAngle(rotation_angle);\r\n\r\n        // update basePoint coordinate\r\n        updateBasePoint(rotation_angle);\r\n    };\r\n\r\n    const rotateLineToVertical = (point1, point2) => {\r\n        let d = calcAngleDegrees(point2.x-point1.x, point2.y-point1.y);\r\n        let needToRotate = -(d + 90); // 順時針轉 ? relative to unrotate state\r\n\r\n        //console.log('箭頭角度 = ', d, '度, 所以，新的順時鐘轉角 = ', needToRotate, '度');\r\n        doRotation(needToRotate);\r\n\r\n        return needToRotate;\r\n    };\r\n\r\n    const zoomCenteringGuide = (pathPoints) => {\r\n        targetPoint = pathPoints[infoIndex];\r\n        // console.log(\"new point coordinate: \", targetPoint.x, targetPoint.y);\r\n        // console.log(\"previous_move: \", previousMove.x, previousMove.y);\r\n\r\n        // before move, move to original state first!\r\n        zoomableViewRef.current.moveBy(-previousMove.x, -previousMove.y);\r\n        const [disX, disY] = distance_center_target(targetPoint);\r\n        zoomableViewRef.current.moveBy(disX, disY);\r\n        setPreviousMove({x: disX, y: disY});\r\n    };\r\n\r\n    const calibraToOriginalTargetPoint = () => {\r\n        basePointGuide(undefined, true);\r\n    };\r\n\r\n    const basePointGuide_Going = (nowPathPoints) => {\r\n\r\n        let updatedAngle = rotateLineToVertical(nowPathPoints[infoIndex], nowPathPoints[infoIndex+1]);\r\n        let disVector = computeVector(basePoint.current, nowPathPoints[infoIndex]);\r\n        let rotDicVector = rotatePoint(disVector, updatedAngle);\r\n        const [disX, disY] = scale_to_canvas(rotDicVector);\r\n        zoomableViewRef.current.moveBy(disX, disY);\r\n\r\n        // consequence of auto move:\r\n        targetPoint = nowPathPoints[infoIndex];\r\n        basePoint.current = {x: targetPoint.x, y: targetPoint.y};\r\n        previousAutoTotalMove.current = {x: previousAutoTotalMove.current.x + disX, y: previousAutoTotalMove.current.y + disY};\r\n        // 同步: Transform move(by Hand) = Auto Move 等於沒有手移動了\r\n        previousTransformTotalMove.current = previousAutoTotalMove.current;\r\n    };\r\n\r\n    const basePointGuide = (nowPathPoints, calibraOnly) => {\r\n\r\n        if (calibraOnly === false) {\r\n            if (infoIndex == nowPathPoints.length -1) {\r\n                console.log(\"到最後一點了\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        // 先旋轉，再平移 image。 (若一開始位置偏移，就要先校正)\r\n        if (zoomVal.current !== initialZoomValue) {\r\n            // zoomTo() need some time to excute\r\n            zoomableViewRef.current.zoomTo(initialZoomValue);\r\n\r\n            setTimeout(() => {\r\n                const calibraVector = {\r\n                    x: -(previousTransformTotalMove.current.x - previousAutoTotalMove.current.x), \r\n                    y: -(previousTransformTotalMove.current.y - previousAutoTotalMove.current.y)\r\n                };\r\n                zoomableViewRef.current.moveBy(calibraVector.x, calibraVector.y);\r\n                zoomVal.current = initialZoomValue;\r\n\r\n                // Hand move = Auto Move 等於沒有手移動了\r\n                previousTransformTotalMove.current = previousAutoTotalMove.current;\r\n\r\n                if (calibraOnly === false) {\r\n                    basePointGuide_Going(nowPathPoints);\r\n                }\r\n            }, 1200);\r\n        }\r\n        else if (previousTransformTotalMove.current !== previousAutoTotalMove.current) {\r\n            const calibraVector = {\r\n                x: -(previousTransformTotalMove.current.x - previousAutoTotalMove.current.x), \r\n                y: -(previousTransformTotalMove.current.y - previousAutoTotalMove.current.y)\r\n            };\r\n            // 校正時，不須紀錄autoMove\r\n            zoomableViewRef.current.moveBy(calibraVector.x, calibraVector.y);\r\n    \r\n            // 同步: Transform move(by Hand) = Auto Move 等於沒有手移動了\r\n            previousTransformTotalMove.current = previousAutoTotalMove.current;\r\n\r\n            if (calibraOnly === false) {\r\n                basePointGuide_Going(nowPathPoints);\r\n            }\r\n        }\r\n        else {\r\n            if (calibraOnly === false) {\r\n                basePointGuide_Going(nowPathPoints);\r\n            }\r\n        }\r\n    };\r\n    \r\n    useEffect(() => {\r\n        if (mapFloor > -100 && infoIndex >= 0) {\r\n            let tmpInstructions = instructions[mapFloor.toString()];\r\n            let currentPathPoints = getPathCoordinates(tmpInstructions);\r\n            if (infoIndex > 0) {\r\n                tmpInstructions = tmpInstructions.slice(infoIndex);\r\n            }\r\n\r\n            setSvgPath(changePath(tmpInstructions));\r\n            setImageURL(`https://iasl.asia.edu.tw:809/static/image/0${mapFloor}.jpeg`);\r\n\r\n\r\n            // display strategy 1\r\n            //zoomCenteringGuide(currentPathPoints);\r\n\r\n            // display strategy 2\r\n            basePointGuide(currentPathPoints, false);\r\n        }\r\n        else {\r\n            // default image before indoor guide\r\n            setSvgPath('M 0 0 L 0 0');\r\n            setImageURL(`https://reactjs.org/logo-og.png`);\r\n        }\r\n    }, [mapFloor, infoIndex]);\r\n\r\n    // modal: use for check\r\n    const [isModalVisible, setIsModalVisible] = useState(false);\r\n    const [modalContent, setModalContent] = useState(\"你已完成導航路徑，確定要結束嗎?\");\r\n    const handleModalCancel = () => {\r\n        setIsModalVisible(false);\r\n    };\r\n    const handleModal2 = () => {\r\n        setModalContent(\"你還未到達目的地，確定要結束嗎?\");\r\n        setIsModalVisible(true);\r\n    };\r\n    const handleFinish = () => {\r\n        setIsModalVisible(false);\r\n\r\n        navigation.navigate('ChatBot');\r\n\r\n        const [hour, min] = getNowTime();\r\n        sendJsonMessage({\r\n            'author': \"user\",\r\n\t\t\t'type':'text',\r\n\t\t\t'message': '/done',\r\n\t\t\t'time': hour + ':' + min,\r\n        });\r\n        dispatch(setDialogMessages([]));\r\n\t\tdispatch(setInstructionTexts({}));\r\n        dispatch(setMapFloor(-100));\r\n        dispatch(setFloorArray([]));\r\n    };\r\n\r\n    return (\r\n        <SafeAreaView style={styles.crossPlatformContainer}>\r\n\r\n            <View style={styles.headerContainer}>\r\n                <Button style={styles.goBackView} title=\"回到對話模式\" onPress={() => navigation.goBack()} />\r\n                <TouchableOpacity style={styles.calibrationButtonViewStyle} onPress={() => calibraToOriginalTargetPoint()}>\r\n                    <Text style={styles.calibrationButtonTextStyle}>\r\n                        定位回導航點\r\n                        <MaterialCommunityIcons name=\"crosshairs-gps\" color=\"black\" size={25} />\r\n                    </Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity style={styles.stopButtonViewStyle} onPress={() => handleModal2()}>\r\n                    <Text style={styles.calibrationButtonTextStyle}>\r\n                        結束\r\n                    </Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            <View style={styles.bodyContainer}>\r\n                <ReactNativeZoomableView\r\n                    maxZoom={10} \r\n                    minZoom={1} \r\n                    zoomStep={0.5} \r\n                    initialZoom={initialZoomValue} \r\n                    bindToBorders={false} \r\n                    //onLongPress = {(event, gestureState) => console.log(gestureState)}\r\n                    \r\n                    // 觀念: image 在任何位置，旋轉角度均不會改變 zoomableViewEventObject的offsetX、offsetY\r\n                    // onShiftingEnd = {(event, gestureState, zoomableViewEventObject) => {\r\n                    //     // console.log(zoomableViewEventObject);\r\n                    //     previousHandTotalMove.current = {x: -zoomableViewEventObject.offsetX*zoomVal.current, y: -zoomableViewEventObject.offsetY*zoomVal.current};\r\n                    // }}\r\n                    // onZoomEnd = {(event, gestureState, zoomableViewEventObject) => {\r\n                    //     zoomVal.current = zoomableViewEventObject.zoomLevel;\r\n                    // }}\r\n                    onTransform = {(zoomableViewEventObject) => {\r\n                        // two possibility: by guesture or by program\r\n                        // console.log('onTransform called', zoomableViewEventObject);\r\n                        zoomVal.current = zoomableViewEventObject.zoomLevel;\r\n                        previousTransformTotalMove.current = {x: -zoomableViewEventObject.offsetX*zoomableViewEventObject.zoomLevel, y: -zoomableViewEventObject.offsetY*zoomableViewEventObject.zoomLevel}\r\n                    }}\r\n                    ref={zoomableViewRef}>\r\n\r\n                    <ImageBackground\r\n                        source={{ uri: imageURL }} \r\n                        style={[\r\n                            styles.bgImageStyle, \r\n                            {\r\n                                width: svg_width, \r\n                                height: svg_height, \r\n                                transform: [{ rotate: `${angle}deg` }, {translateX: 0}]\r\n                            }\r\n                        ]}\r\n                    >\r\n\r\n                        <Svg width={svg_width} height={svg_height} viewBox={viewBoxProps}>\r\n                            <Defs>\r\n                                <Marker\r\n                                    id=\"MapModeTriangle\"\r\n                                    viewBox=\"0 0 10 10\"\r\n                                    refX=\"0\"\r\n                                    refY=\"5\"\r\n                                    markerUnits=\"strokeWidth\"\r\n                                    markerWidth=\"3\"\r\n                                    markerHeight=\"3\"\r\n                                    orient=\"auto\"\r\n                                >\r\n                                    <Path\r\n                                        d=\"M 0 0 L 10 5 L 0 10 z\" \r\n                                        fill=\"black\"\r\n                                        stroke=\"red\"\r\n                                        strokeWidth=\"1\"\r\n                                    />\r\n                                </Marker>\r\n                                <Marker\r\n                                    id=\"MapModestartPoint\"\r\n                                    viewBox=\"0 0 10 10\"\r\n                                    refX=\"5\"\r\n                                    refY=\"5\"\r\n                                    markerUnits=\"strokeWidth\"\r\n                                    markerWidth=\"3\"\r\n                                    markerHeight=\"3\"\r\n                                    orient=\"auto\"\r\n                                >\r\n                                        <Circle \r\n                                            cx=\"5\" \r\n                                            cy=\"5\" \r\n                                            r=\"8\" \r\n                                            fill=\"green\"\r\n                                        />\r\n                                </Marker>\r\n                                <Marker\r\n                                    id=\"MapModemidPoint\"\r\n                                    viewBox=\"0 0 10 10\"\r\n                                    refX=\"5\"\r\n                                    refY=\"5\"\r\n                                    markerUnits=\"strokeWidth\"\r\n                                    markerWidth=\"2\"\r\n                                    markerHeight=\"2\"\r\n                                    orient=\"auto\"\r\n                                >\r\n                                    <Circle cx=\"5\" cy=\"5\" r=\"8\" fill=\"grey\"/>\r\n                                </Marker>\r\n                            </Defs>\r\n\r\n                            <Path\r\n                                d={svgPath}\r\n                                // d=\"M 0 0 L 10 5 L 0 10 z\"\r\n                                fill=\"none\"\r\n                                stroke=\"#ff3333\"\r\n                                strokeWidth=\"5\"\r\n                                markerStart=\"url(#MapModestartPoint)\"\r\n                                markerMid=\"url(#MapModemidPoint)\"\r\n                                markerEnd=\"url(#MapModeTriangle)\"\r\n                            />\r\n                        </Svg>\r\n\r\n                    </ImageBackground>\r\n\r\n                </ReactNativeZoomableView>\r\n            </View>\r\n            \r\n            {\r\n                ifGuideStart() ?\r\n                <View style={styles.bottomContainer}>\r\n                    <View style={styles.guideContainer}>\r\n                        <Text style={styles.mainTextStyle}>\r\n                            {instructiontext[floorArray[floorIndex]][\"subCategory\"][infoIndex][\"name\"]}\r\n                        </Text>\r\n                    </View>\r\n\r\n                    <View style={[styles.multiColumnContaner ]}>\r\n                        <View style={styles.subKeywordViewContainer}>\r\n                            <Text style={styles.subKeywordStyle}>接下來</Text>\r\n                        </View>\r\n                        <View style={styles.subTextViewContainer}>\r\n                            <Text style={styles.subTextStyle}>{nextInstructionText}</Text>\r\n                        </View>\r\n                    </View>\r\n\r\n                    <View style={styles.multiColumnContaner}>\r\n                        <TouchableOpacity style={[styles.paginationButtonContainer, {borderRightColor: \"white\", borderRightWidth: 0.5}]} onPress={() => goNextStep(-1)}>\r\n                            <Text style={styles.buttonTextStyle}>上一步</Text>\r\n                        </TouchableOpacity>\r\n                        <TouchableOpacity style={[styles.paginationButtonContainer, {borderLeftColor: \"white\", borderLeftWidth: 0.5}]} onPress={() => goNextStep(1)}>\r\n                            <Text style={styles.buttonTextStyle}>下一步</Text>\r\n                        </TouchableOpacity>\r\n\r\n                    </View>\r\n                </View>\r\n                : <View style={styles.bottomContainer}></View>\r\n            }\r\n\r\n\r\n            <Modal isVisible={isModalVisible}>\r\n                <View style={styles.modalViewContainer}>\r\n                    <Text style={styles.modalTextStyle}>{modalContent}</Text>\r\n                    <View style={{flexDirection: 'row', justifyContent: 'flex-end'}}>\r\n                        <TouchableOpacity onPress={handleFinish}>\r\n                            <Text style={styles.modalYesButtonStyle}>是</Text>\r\n                        </TouchableOpacity>\r\n                        <TouchableOpacity onPress={handleModalCancel}>\r\n                            <Text style={styles.modalNoButtonStyle}>否</Text>\r\n                        </TouchableOpacity>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </SafeAreaView>\r\n\r\n        \r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    crossPlatformContainer: {\r\n        flex: 1,\r\n        paddingTop: Platform.OS === 'android' ? 0 : 0\r\n    },\r\n    headerContainer: {\r\n        alignSelf: 'stretch',\r\n        flexDirection: \"row\",\r\n        justifyContent: \"space-between\"\r\n    },\r\n    bodyContainer: {\r\n        flexGrow: 1,\r\n        backgroundColor: \"#EAF0F2\"\r\n    },\r\n    bottomContainer: {\r\n        marginHorizontal: 0,\r\n        backgroundColor: \"red\"\r\n    },\r\n    goBackBotton: {\r\n        flexGrow: 1\r\n    },\r\n    calibrationButtonViewStyle: {\r\n        backgroundColor: \"white\",\r\n        flexGrow: 1\r\n    },\r\n    calibrationButtonTextStyle:{\r\n        color: \"black\",\r\n        textAlign: \"center\",\r\n    },\r\n    stopButtonViewStyle: {\r\n        backgroundColor: \"#e6658c\",\r\n        flexGrow: 1,\r\n        justifyContent: 'center'\r\n    },\r\n    bgImageStyle: {\r\n\t\talignSelf: \"center\",\r\n\t},\r\n\r\n    guideContainer: {\r\n        backgroundColor: '#198039',\r\n        paddingVertical: 12,\r\n        paddingHorizontal: 15,\r\n    },\r\n    mainTextStyle: {\r\n        color: \"white\",\r\n        fontSize: 18,\r\n        fontWeight: \"500\",\r\n    },\r\n    multiColumnContaner: {\r\n        flexDirection:'row',\r\n        justifyContent: \"space-between\",\r\n    },\r\n    subKeywordViewContainer: {\r\n        width: 86,\r\n        backgroundColor: \"#eff2d7\",\r\n        paddingVertical: 10,\r\n        paddingHorizontal: 15,\r\n        justifyContent: 'center',\r\n    },\r\n    subKeywordStyle: {\r\n        textAlign: \"center\",\r\n        fontSize: 16,\r\n    },\r\n    subTextViewContainer: {\r\n        justifyContent: 'center',\r\n        paddingHorizontal: 10,\r\n        backgroundColor: \"#d7f3da\",\r\n        flexGrow: 1,\r\n        flexShrink: 1,\r\n    },\r\n    subTextStyle: {\r\n        fontSize: 15,\r\n        textAlign: \"center\",\r\n    },\r\n    paginationButtonContainer: {\r\n        flexGrow: 1,\r\n        backgroundColor: \"#0d662e\",\r\n    },\r\n    buttonTextStyle: {\r\n        paddingVertical: 10,\r\n        textAlign: \"center\",\r\n        fontSize: 14,\r\n        color: \"white\",\r\n        fontWeight: \"500\",\r\n    },\r\n\r\n    modalViewContainer: {\r\n        justifyContent: \"space-between\",\r\n\r\n        backgroundColor: \"white\", \r\n        height: 120, \r\n        borderRadius: 10,\r\n        padding: 15\r\n    },\r\n    modalTextStyle: {\r\n        fontSize: 20,\r\n        textAlign: \"center\",\r\n    },\r\n    modalYesButtonStyle: {\r\n        color: \"#4584fc\",\r\n        paddingHorizontal: 18,\r\n        fontSize: 16,\r\n    },\r\n    modalNoButtonStyle: {\r\n        color: \"#858585\",\r\n        paddingHorizontal: 18,\r\n        fontSize: 16,\r\n    },\r\n})\r\n\r\n\r\nexport default MapNavigationScreen;","import { createStackNavigator  } from '@react-navigation/stack';\r\nimport ChatBotScreen from '../screens/ChatBotScreen';\r\nimport MapNavigationScreen from '../screens/MapNavigationScreen';\r\n\r\n\r\n\r\n// reference: https://reactnavigation.org/docs/stack-navigator/\r\n\r\n// define navigation API\r\nconst Stack = createStackNavigator();\r\n\r\nexport default function MyStack() {\r\n    return (\r\n        <Stack.Navigator \r\n            initialRouteName=\"ChatBot\"\r\n            screenOptions={({ route, navigation }) => ({\r\n                headerShown: false,\r\n                gestureEnabled: true,\r\n          })}\r\n        >\r\n            <Stack.Screen name=\"ChatBot\" component={ChatBotScreen} />\r\n            <Stack.Screen name=\"MapNavigation\" component={MapNavigationScreen} />\r\n        </Stack.Navigator>\r\n    );\r\n}","import { registerRootComponent } from 'expo';\r\nimport { AppRegistry } from 'react-native';\r\n\r\nimport App from './App';\r\n\r\n// registerRootComponent calls AppRegistry.registerComponent('main', () => App);\r\n// It also ensures that whether you load the app in Expo Go or in a native build,\r\n// the environment is set up appropriately\r\nimport {name as appName} from './app.json';\r\n\r\nregisterRootComponent(App);\r\n","import { Provider } from 'react-redux';\r\nimport { store } from './store';\r\nimport { NavigationContainer } from '@react-navigation/native';\r\nimport MyStack from './routes/MyStack';\r\n\r\n\r\n\r\nexport default function App() {\r\n  return (\r\n    <Provider store={store}>\r\n      <NavigationContainer>\r\n        <MyStack />\r\n      </NavigationContainer>\r\n    </Provider>\r\n  );\r\n}\r\n"],"sourceRoot":""}